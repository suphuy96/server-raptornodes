(()=>{var n={783:function(d,e,t){"use strict";var u=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var f=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var p=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))u(t,e,r);f(t,e);return t};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const n=r(t(6860));const m=r(t(7455));const h=r(t(6508));const o=r(t(3986));const a=r(t(4695));const g=r(t(7730));const y=r(t(8627));const w=r(t(1017));const s=r(t(1185));const v=r(t(3511));const S=r(t(3983));const i=t(849);const b=r(t(6962));const _=r(t(3419));const A=r(t(5991));const E=t(8251);const k=p(t(507));const M=t(2081);const l=n.default();l.use(A.default.express());const c=i.MONGODB_URI+(process.env.TESTNET==="1"?process.env.DB_NAME_TESTNET:i.DB_NAME_MANNET);s.default.Promise=S.default;console.log("db"+process.env.TESTNET+c);s.default.connect(c,{useNewUrlParser:true,useCreateIndex:true,useUnifiedTopology:true}).then(()=>{}).catch(e=>{console.log(`MongoDB connection error. Please make sure MongoDB is running. ${e}`)});function R(e){const t=parseInt(e,10);if(isNaN(t)){return e}if(t>=0){return t}return false}const N=R(process.env.PORT||"8080");l.set("port",N);l.use(m.default());l.use(o.default.json());l.use(o.default.urlencoded({extended:true}));l.use(h.default({resave:true,saveUninitialized:true,secret:i.SESSION_SECRET,cookie:{maxAge:parseInt(process.env.MAXAGE),signed:true},store:new g.default({mongoUrl:c,ttl:864e5,autoRemove:"interval",autoRemoveInterval:10,mongoOptions:{autoReconnect:true}})}));l.use(v.default.initialize());l.use(v.default.session());l.use(y.default());l.use(a.default.xframe("SAMEORIGIN"));l.use(a.default.xssProtection(true));l.use((e,t,r)=>{t.locals.user=e.user;r()});l.use((e,t,r)=>{if(!e.user&&e.path!=="/login"&&e.path!=="/signup"&&!e.path.match(/^\/auth/)&&!e.path.match(/\./)){e.session.returnTo=e.path}else if(e.user&&e.path=="/account"){e.session.returnTo=e.path}r()});l.use(n.default.static(w.default.join(__dirname,"public"),{}));l.get("/refresh",(e,t)=>{t.render("refresh",{title:"refresh"})});l.use(_.default());l.use(b.default());l.get("/backup/file/:fileName",k.isAuthenticated,function(e,t){const r={root:E.getPathFile()};console.log(e.user,"check");const n=e.params.fileName;t.sendFile(n,r,function(e){if(e){t.send("error")}else{console.log("Sent:",n)}})});l.use("/webhook/github",(e,t,r)=>{console.log("vafo ddayadddd");const n=M.exec("git pull",{cwd:"/usr/web/raptornodes.com"},()=>{console.log("---github")});t.send("huyquansu")});e["default"]=l},507:function(a,e,t){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))s(t,e,r);i(t,e);return t};var r=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var h=this&&this.__asyncValues||function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=o[Symbol.asyncIterator],t;return e?e.call(o):(o=typeof __values==="function"?__values(o):o[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=o[n]&&function(r){return new Promise(function(e,t){r=o[n](r),a(e,t,r.done,r.value)})}}function a(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}};var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});e.isAuthorized=e.isAuthenticated=void 0;const o=n(t(3511));const c=n(t(7055));const d=n(t(7352));const u=l(t(6517));const g=t(5828);const p=t(2656);const y=t(5069);const w=t(6164);const v=t(7135);const S=n(t(9344));const b=t(136);const _=t(4743);const A=n(t(8351));const f=t(849);u.default.templateSettings.interpolate=/{{([\s\S]+?)}}/g;const E={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const m=new A.default(E);const k=c.default.Strategy;o.default.serializeUser((e,t,r)=>{r(undefined,t)});o.default.deserializeUser((e,r)=>{p.User.findById(e,(e,t)=>r(e,t))});o.default.use(new k({usernameField:"email"},(t,n,o)=>{p.User.findOne({email:t.toLowerCase()},(e,r)=>{if(e){return o(e)}if(!r){return o(undefined,false,{message:`Email ${t} not found.`})}r.comparePassword(n,(e,t)=>{if(e){return o(e)}if(t){return o(undefined,r)}return o(undefined,false,{message:"Invalid email or password."})})})}));o.default.use(new b.Strategy({jwtFromRequest:e=>{let t="";if(e&&e.cookies){t=e.cookies["jwt"]}else if(e&&e.headers&&e.headers["authorization"]){t=e.headers["authorization"].toString()}return t},secretOrKey:f.SESSION_SECRET,issuer:"accounts."+process.env.DOMAIN,audience:process.env.DOMAIN},(e,r)=>{p.User.findOne({email:e.email,tokenJWT:e.tokenJWT},(e,t)=>{if(e){return r(e)}if(!t){return r(undefined,false,{message:"token hết hạn."})}return r(undefined,false,{message:"Invalid email or password."})})}));const M=["identify","email"];o.default.use(new _.Strategy({clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:f.GOOGLE_CLIENT_SECRET,scope:["profile","email"],callbackURL:process.env.CALLBACKURL+"/auth/google/callback",passReqToCallback:true},function(s,i,e,l,c){if(s.user){try{if(global.settingSystem.mailNewSession.enable){d.default(s.user.email+(global.settingSystem.mailNewSession.cc&&global.settingSystem.mailNewSession.cc.length?","+global.settingSystem.mailNewSession.cc.join():""),u.default.template(global.settingSystem.mailNewSession.label)({name:s.user.name,email:s.user.email,avatar:s.user.profile.picture,data:""}),u.default.template(global.settingSystem.mailNewSession.template)({name:s.user.name,email:s.user.email,avatar:s.user.profile.picture,data:""})).then(e=>{console.log(e)})}}catch(e){console.log(e)}p.User.findOne({google:l.id},(e,t)=>{if(e){return c(e)}if(t){s.flash("errors",{msg:"There is already a google account that belongs to you. Sign in with that account or delete it, then link it with your current account."});c(e)}else{p.User.findById(s.user.id,(e,t)=>{if(e){return c(e)}t.google=l.id;t.tokens.push({kind:"discord",accessToken:i});if(l.name)t.profile.name=t.profile.name||`${l.name.givenName} ${l.name.familyName||""}`;else{t.profile.name=t.profile.name||l._json.email}t.profile.picture=t.profile.picture||l._json.picture;t.save(e=>{s.flash("info",{msg:"Google account has been linked."});c(e,t)})})}})}else{p.User.findOne({google:l.id},(e,t)=>{if(e){return c(e)}if(t){try{console.log("vào đây");if(global.settingSystem.mailNewSession.enable){d.default(t.email+(global.settingSystem.mailNewSession.cc&&global.settingSystem.mailNewSession.cc.length?","+global.settingSystem.mailNewSession.cc.join():""),u.default.template(global.settingSystem.mailWellcome.label)({name:t.profile.name,email:t.email,avatar:t.profile.picture,data:""}),u.default.template(global.settingSystem.mailWellcome.template)({name:t.profile.name,email:t.email,avatar:t.profile.picture,data:""})).then(e=>{console.log("data",e)})}}catch(e){console.log(e)}return c(undefined,t)}p.User.findOne({email:l._json.email},(t,a)=>r(this,void 0,void 0,function*(){if(t){return c(t)}if(a){console.log("vào đây555");s.flash("errors",{msg:"There is already an account using this email addr ess. Sign in to that account and link it with Facebook manually from Account Settings."});c(t)}else{console.log("vào đây444");if(global.settingSystem.isMaintenance){s.flash("errors",{msg:"System is Maintenance"});return c(new Error("System is Maintenance"))}const r=new p.User;r.rules="User";r.email=l._json.email;if(f.ADMINS.indexOf(r.email+",")!==-1){r.rules="Admin"}r.google=l.id;let t="User#"+r.email;const e=yield m.getAddressesByAccount(t);if(e&&e.length){t="User#"+r.email+"_"+(new Date).getTime()}try{let e=yield m.getAccountAddress(t).catch(e=>{console.log("không thể kết nối raptoreum",e.toString());return false});const n=yield p.User.findOne({addressRTM:e});if(n){e=yield m.getAccountAddress(t).catch(e=>{console.log("không thể kết nối raptoreum",e.toString());return false})}const o=S.default.sign({email:r.email,tokenJWT:g.v4()},f.SESSION_SECRET,{expiresIn:1e7});r.tokenJWT=o;if(e){r.accountRTM=t;r.addressRTM=e}else{r.accountRTMError=true}}catch(e){r.accountRTMError=true}r.tokens.push({kind:"google",accessToken:i});if(l.name){r.profile.name=`${l.name.givenName} ${l.name.familyName||""}`}else{r.profile.name=r.email}r.profile.picture=r.profile.picture||l._json.picture;r.save(e=>{try{if(global.settingSystem&&global.settingSystem.mailWellcome&&global.settingSystem.mailWellcome.enable){d.default(r.email+(global.settingSystem.mailWellcome.cc.length?","+global.settingSystem.mailWellcome.cc.join():""),u.default.template(global.settingSystem.mailWellcome.label)({name:r.profile.name,email:r.email,avatar:r.profile.picture,data:""}),u.default.template(global.settingSystem.mailWellcome.template)({name:r.profile.name,email:r.email,avatar:r.profile.picture,data:""})).then(e=>{console.log("đàads")})}}catch(e){}c(e,r)})}}))})}}));const R=new v.Strategy({clientID:process.env.CLIENTID,clientSecret:process.env.CLIENTSECRET,callbackURL:process.env.CALLBACKURL+"/auth/discord/callback",scope:M,passReqToCallback:true},function(c,d,e,u,f){if(c.user){p.User.findOne({discord:u.id},(e,t)=>{if(e){return f(e)}if(t){c.flash("errors",{msg:"There is already a discord account that belongs to you. Sign in with that account or delete it, then link it with your current account."});f(e)}else{p.User.findById(c.user.id,(i,l)=>r(this,void 0,void 0,function*(){var t,e;if(i){return f(i)}console.log(u);console.log("profile.id",u.id);if(l.discord&&l.discord!==""){return f(new Error("You need to unlink discord before link."))}l.discord=u.id+"";const r=yield w.DataOld.find({discordId:l.discord});if(r&&r.length){try{for(var n=h(r),o;o=yield n.next(),!o.done;){const a=o.value;const s=yield y.SmartNode.findOne({label:a.smartNode});if(!s.participants.find(e=>e.userId===c.user._id)){s.participants.push({userId:c.user._id,RTMRewards:a.RTMRewards,collateral:a.collateral,pendingRTMRewards:a.pendingRTMRewards,percentOfNode:a.percentOfNode,txids:[],time:new Date})}yield s.save()}}catch(e){t={error:e}}finally{try{if(o&&!o.done&&(e=n.return))yield e.call(n)}finally{if(t)throw t.error}}}l.tokens.push({kind:"discord",accessToken:d});if(l.profile){l.profile.discordName=`${u.username}#${u.discriminator}`;l.profile.discordAvatar=`https://cdn.discordapp.com/avatars/${u.id}/${u.avatar}.png`}else{l.profile={location:"",picture:"",website:"",gender:"",name:l.profile.name||u.email,discordName:l.profile.name||u.email}}l.save(e=>{c.flash("info",{msg:"Discord account has been linked."});f(e,l)})}))}})}else{c.flash("errors",{msg:"You need to login before you can use it"});f(new Error("You need to login before you can use it"))}});if(process.env.AUTHENDISCORD){o.default.use(R)}const N=(e,t,r)=>{if(e.isAuthenticated()){return r()}t.redirect("/login")};e.isAuthenticated=N;const T=(e,t,r)=>{const n=e.path.split("/").slice(-1)[0];const o=e.user;if(u.find(o.tokens,{kind:n})){r()}else{t.redirect(`/auth/${n}`)}};e.isAuthorized=T},6878:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(1185);t["default"]={_id:new n.mongo.ObjectId,enableWithdraw:true,testnet:true,collateral:15e5,collateralMin:1e3,paymentsPerDay:1.61,rewardAddress:"",rewardAccount:"",feeReward:3.5,scheduleTime:"0 0",scheduleDay:"mon",scheduleValue:7,mailWellcome:{label:"Wellcome to raptornodes.com",template:'Wellcome to raptornodes.com",Hello {{name}},Thank you for trusting us.',cc:new Array(0),enable:true},mailNewSession:{label:"you have new Session login raptornodes.com",template:"Hey {{name}}, you have new Session login raptornodes.com",cc:new Array(0),enable:true},mailWithdraw:{label:"you have new Withdraw in raptornodes.com",template:"you have new Withdraw in raptornodes.com {{name}}",cc:new Array(0),enable:true},mailDespost:{label:"you have new despost in raptornodes.com",template:"Hey {{name}}, you have new despost in raptornodes.com",cc:new Array(0),enable:true},mailJobSmartNode:{label:"you have new JobSmartNode in raptornodes.com",template:"Hey {{name}}you have new JobSmartNode in raptornodes.com",cc:new Array(0),enable:true},mailTfa:{label:"you enable Tfa in raptornodes.com",template:"Hey {{name}} you enable Tfa in raptornodes.com",cc:new Array(0),enable:true},mailReward:{label:"you got Reward in raptornodes.com",template:"Hey {{name}} you got Reward in raptornodes.com",cc:new Array(0),enable:true},createdAt:new Date,updatedAt:new Date}},9324:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const a=o(r(8251));const s=r(2811);const i=o(r(2245));const l=o(r(8311));t["default"]=()=>{const e=l.default.schedule("59 23 * * *",()=>n(void 0,void 0,void 0,function*(){const e=new s.Backup;console.log("schedule backup");e.label="auto backup"+i.default(new Date).format("DD/MM/YYYY HH:mm");const t=i.default(new Date).format("DD-MM-YYYY_HH_mm")+".zip";const r=yield a.default(t);e.path=t;yield e.save()}))}},4730:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const o=r(7343);const a=r(6548);const s=n(r(2245));t["default"]={Date:new o.GraphQLScalarType({name:"Date",description:"Date custom scalar type by huyquansu",parseValue(e){console.log("vaof daya");const t=new Date(Date.parse(e));return t},serialize(e){console.log("vaof daya");return s.default(e,"DD/MM/YYYY").format("DD/MM/YYYY")},parseLiteral(e){console.log("vaof daya");const t=new Date(Date.parse(e.value));if(t.toString()==="Invalid Date"){throw new o.GraphQLError("Không thể format Date")}return t}}),DateTime:new o.GraphQLScalarType({name:"DateTime",description:"Date custom scalar type by huyquansu",parseValue(e){return new Date(e)},serialize(e){return s.default(e).format("DD/MM/YYYY HH:mm:ss")},parseLiteral(e){const t=new Date(e.value);if(t.toString()==="Invalid Date"){throw new o.GraphQLError("Không thể format Date")}return t}}),Time:new o.GraphQLScalarType({name:"Time",description:"Date custom scalar type by huyquansu",parseValue(e){return new Date(e)},serialize(e){return e},parseLiteral(e){if(e.kind===a.Kind.INT){return new Date(e.value)}return null}})}},5932:function(a,e,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};var s=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const i=t(6055);const l=t(2811);const c=t(4103);const d=r(t(8251));const f=u(t(2245));const p={Query:{backups:(e,t,r)=>s(void 0,void 0,void 0,function*(){try{c.checkIsAdmin(r.user);return yield l.Backup.find().populate("author")}catch(e){throw new i.ApolloError(e)}})},Mutation:{createBackup:(e,o,a)=>s(void 0,void 0,void 0,function*(){try{c.checkIsAdmin(a.user);const e=new l.Backup;e.label=o.label;const t=f.default(new Date).format("DD-MM-YYYY_HH_mm")+".zip";const r=yield d.default(t);e.path=t;e.author=a.user._id;const n=yield e.save();return n}catch(e){throw new i.ApolloError(e)}}),reStore:(e,r,n)=>s(void 0,void 0,void 0,function*(){try{c.checkIsAdmin(n.user);const e=yield l.Backup.findById(r._id);if(!e){throw new i.ApolloError("Not found document")}const t=yield d.reStoreBK(e.path);return e}catch(e){throw new i.ApolloError(e)}}),deleteBackup:(e,t,r)=>s(void 0,void 0,void 0,function*(){try{c.checkIsAdmin(r.user);const e=yield l.Backup.findOne({_id:t._id});if(!e){throw new i.ApolloError("Not found document")}e.delete();return e}catch(e){throw new i.ApolloError(e)}})}};e["default"]=p},4643:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};Object.defineProperty(t,"__esModule",{value:true});const o=r(6055);const a=r(7128);const s=r(4103);const i={Query:{contacts:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{s.checkIsAdmin(r.user);return yield a.Contact.find()}catch(e){throw new o.ApolloError(e)}})},Mutation:{createContact:(e,r,t)=>n(void 0,void 0,void 0,function*(){try{const e=new a.Contact;e.title=r.title;e.content=r.content;e.name=r.name;e.email=r.email;const t=yield e.save();return t}catch(e){throw new o.ApolloError(e)}}),deleteContact:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{s.checkIsAdmin(r.user);const e=yield a.Contact.findOne({_id:t._id});if(!e){throw new o.ApolloError("Not found document")}e.delete();return e}catch(e){throw new o.ApolloError(e)}})}};t["default"]=i},2353:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};Object.defineProperty(t,"__esModule",{value:true});const a=r(6055);const s=r(6164);const i=r(4103);const n={Query:{dataOlds:(e,t,r)=>o(void 0,void 0,void 0,function*(){try{return yield s.DataOld.find()}catch(e){throw new a.ApolloError(e)}})},Mutation:{importDataOld:(e,t,r)=>o(void 0,void 0,void 0,function*(){try{i.checkIsAdmin(r.user);yield s.DataOld.deleteMany({});yield s.DataOld.insertMany(t.dataOlds);return true}catch(e){throw new a.ApolloError(e)}}),createDataOld:(e,r,n)=>o(void 0,void 0,void 0,function*(){try{i.checkIsAdmin(n.user);const e=new s.DataOld;e.address=r.address;e.discordName=r.discordName;e.discordId=r.discordId;e.RTMRewards=r.RTMRewards;e.collateral=r.collateral;e.percentOfNode=r.percentOfNode;e.RTMRewards=r.RTMRewards;e.pendingRTMRewards=r.pendingRTMRewards;e.smartNode=r.smartNode;const t=yield e.save();return t}catch(e){throw new a.ApolloError(e)}}),updateDataOld:(e,t,r)=>o(void 0,void 0,void 0,function*(){try{i.checkIsAdmin(r.user);const e=yield s.DataOld.findById(t._ida);if(!e){throw new a.ApolloError("Not found document")}if(t.discordName){e.discordName=t.discordName}if(t.discordId){e.discordId=t.discordId}if(t.collateral){e.collateral=t.collateral}if(t.percentOfNode){e.percentOfNode=t.percentOfNode}if(t.RTMRewards){e.RTMRewards=t.RTMRewards}if(t.pendingRTMRewards){e.pendingRTMRewards=t.pendingRTMRewards}if(t.smartNode){e.smartNode=t.smartNode}return e}catch(e){throw new a.ApolloError(e)}}),deleteDataOld:(e,t,r)=>o(void 0,void 0,void 0,function*(){try{i.checkIsAdmin(r.user);const e=yield s.DataOld.findOne({_id:t._id});if(!e){throw new a.ApolloError("Not found document")}e.delete();return e}catch(e){throw new a.ApolloError(e)}})}};t["default"]=n},4004:function(c,e,t){"use strict";var a=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const s=t(6055);const i=t(2073);const l=t(4103);const o=r(t(9200));const n={Query:{dataUltraFastEarning:(e,t,o)=>a(void 0,void 0,void 0,function*(){try{l.checkIsAuthen(o.user);const e=yield i.DataUltraFastEarning.find().populate("participants.author");if(e.length===0){const r={};const n=new i.DataUltraFastEarning(r);yield n.save();return n}const t=e[0];return t}catch(e){throw new s.ApolloError(e)}}),dataUltraFastEarningMe:(e,t,o)=>a(void 0,void 0,void 0,function*(){try{l.checkIsAuthen(o.user);const e=yield i.DataUltraFastEarning.find();if(e.length===0){const r={};const n=new i.DataUltraFastEarning(r);yield n.save();return[]}const t=e[0];console.log("re.participants",t.participants,o.user._id,o.user._id.equals(t.participants[0].author));return t.participants.filter(e=>o.user._id.equals(e.author))}catch(e){throw new s.ApolloError(e)}})},Mutation:{updateDataUltraFastEarning:(e,r,n)=>a(void 0,void 0,void 0,function*(){try{l.checkIsAdmin(n.user);if(n.user.enableTfa){if(!r.tfa||r.tfa===""){throw new s.ApolloError("undefined code 2fa")}const t=o.default.totp.verify({secret:n.user.tfa.secret,encoding:"base32",token:r.tfa});if(!t){throw new s.ApolloError("2fa is not correct")}}const e=yield i.DataUltraFastEarning.findOne();return e}catch(e){throw new s.ApolloError(e)}})}};e["default"]=n},7012:function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};Object.defineProperty(t,"__esModule",{value:true});const a=r(6055);const s=r(7025);const i=r(4103);const n={Query:{faqs:(e,t,r)=>o(void 0,void 0,void 0,function*(){try{return yield s.Faq.find().populate("author")}catch(e){throw new a.ApolloError(e)}})},Mutation:{createFaq:(e,r,n)=>o(void 0,void 0,void 0,function*(){try{i.checkIsAdmin(n.user);const e=new s.Faq;e.answer=r.answer;e.label=r.label;e.author=n.user._id;const t=yield e.save();return t}catch(e){throw new a.ApolloError(e)}}),updateFaq:(e,t,r)=>o(void 0,void 0,void 0,function*(){try{i.checkIsAdmin(r.user);const e=yield s.Faq.findById(t._id);if(!e){throw new a.ApolloError("Not found document")}if(t.answer){e.answer=t.answer}if(t.label){e.label=t.label}yield e.save();return e}catch(e){throw new a.ApolloError(e)}}),deleteFaq:(e,t,r)=>o(void 0,void 0,void 0,function*(){try{i.checkIsAdmin(r.user);const e=yield s.Faq.findOne({_id:t._id});if(!e){throw new a.ApolloError("Not found document")}e.delete();return e}catch(e){throw new a.ApolloError(e)}})}};t["default"]=n},4326:function(d,e,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const n=r(t(6249));const o=r(t(3876));const a=r(t(7796));const s=r(t(5047));const i=r(t(1179));const l=r(t(4462));const c=r(t(543));const u=r(t(7012));const f=r(t(4730));const p=r(t(5932));const m=r(t(9547));const h=r(t(9652));const g=r(t(2353));const y=r(t(4643));const w=r(t(8025));const v=r(t(3669));const S=r(t(3950));const b=r(t(3167));const _=r(t(4004));e["default"]=[o.default,s.default,a.default,n.default,l.default,c.default,i.default,f.default,u.default,p.default,m.default,h.default,g.default,y.default,w.default,v.default,S.default,b.default,_.default]},4462:function(c,e,t){"use strict";var n=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const o=t(6055);const a=r(t(8351));const s=t(9970);const i={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const d=new a.default(i);const l={Query:{marketCap:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{const e=yield s.getMarketcap();console.log("ddd",e);return e.data}catch(e){console.log("looixo rồi",e.toString());throw new o.ApolloError(e)}}),totalLockedCoins:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{const e=yield s.getTotalLockedCoins();console.log("ddd",e);return e.data}catch(e){console.log("looixo rồi",e.toString());throw new o.ApolloError(e)}})}};e["default"]=l},3669:function(r,o,e){"use strict";var j=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var B=this&&this.__asyncValues||function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=o[Symbol.asyncIterator],t;return e?e.call(o):(o=typeof __values==="function"?__values(o):o[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=o[n]&&function(r){return new Promise(function(e,t){r=o[n](r),a(e,t,r.done,r.value)})}}function a(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}};var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:true});const q=e(6055);const s=e(1669);const L=e(6609);const l=e(6833);const $=e(5069);const c=e(4103);const a=t(e(8351));const H=t(e(6517));const d=t(e(9200));const U=t(e(7352));const u=t(e(6878));const f={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const C=new a.default(f);const n=e(8311);const J=e(5533);const Y=e(849);const p=e(2073);let m=n.schedule("59 23 * * *",()=>j(void 0,void 0,void 0,function*(){console.log("schedule-- rewardTask ----nulll")}));let h=n.schedule("58 23 * * *",()=>j(void 0,void 0,void 0,function*(){console.log("schedule-- rewardTask2 ----nulll")}));const z=()=>j(void 0,void 0,void 0,function*(){const e=yield p.DataUltraFastEarning.find().populate("participants.author");if(e.length===0){const t={amount:0,status:"Enough",description:""};const r=new p.DataUltraFastEarning(t);yield r.save();return r}return e[0]});const i=x=>j(void 0,void 0,void 0,function*(){var f,p,m,h,g,y,w,v,S,b;try{const i=yield $.SmartNode.find({statusCollateral:"Start Reward"}).populate("participants.userId");const R=yield C.getbalance(global.settingSystem.rewardAccount);const N=yield C.listtransactions([global.settingSystem.rewardAccount,null,null]);const T=N.filter(e=>e&&e.amount&&e.confirmations<101);let t=0;console.log(T);T.forEach(e=>{t+=e.amount});const D=R-t;let e=0;try{for(var _=B(i),r;r=yield _.next(),!r.done;){const l=r.value;try{for(var A=(m=void 0,B(l.participants)),n;n=yield A.next(),!n.done;){const c=n.value;const O="ReWard in Raptornodes.com";const I=global.settingSystem.scheduleValue*(global.settingSystem.paymentsPerDay*c.percentOfNode*((100-global.settingSystem.feeReward)/100));const P=global.settingSystem.scheduleValue*(global.settingSystem.paymentsPerDay*c.percentOfNode*(global.settingSystem.feeReward/100));e+=I}}catch(e){m={error:e}}finally{try{if(n&&!n.done&&(h=A.return))yield h.call(A)}finally{if(m)throw m.error}}}}catch(e){f={error:e}}finally{try{if(r&&!r.done&&(p=_.return))yield p.call(_)}finally{if(f)throw f.error}}if(global.settingSystem.mailReward.cc.length){U.default(global.settingSystem.mailReward.cc.length?global.settingSystem.mailReward.cc.join():"","Schedule ReWard "+i.length+" Smartnode","Schedule ReWard "+i.length+" Smartnode in raptornodes.com, totalReward:"+e.toFixed(8)+"RTM, reWardBalance:"+R+"RTM, balancePending:"+t+"RTM").then(()=>{console.log("")})}if(e>D){try{const d=yield J.System.findOne();d.missingReward=true;d.timeMissingReward=new Date;d.save();x.missingReward=true;x.save()}catch(e){}U.default(process.env.ADMINS,"Error!! Not enough balance to pay the reward, "+i.length+" Smartnode","Schedule ReWard "+i.length+" Smartnode in raptornodes.com, totalReward:"+e.toFixed(8)+"RTM, reWardBalance:"+R+"RTM, balancePending:"+t+"RTM").then(()=>{console.log("")})}else{const W=(a,s,i,l)=>j(void 0,void 0,void 0,function*(){const e="ReWard in Raptornodes.com";const t=global.settingSystem.scheduleValue*(global.settingSystem.paymentsPerDay*i*((100-global.settingSystem.feeReward)/100));const r=global.settingSystem.scheduleValue*(global.settingSystem.paymentsPerDay*i*(global.settingSystem.feeReward/100));try{yield C.walletpassphrase(Y.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const n=yield C.sendFrom({address:a.addressRTM,account:global.settingSystem.rewardAccount,comment:e,amount:parseFloat(t.toFixed(8)),comment_to:""}).catch(e=>{U.default(global.settingSystem.mailReward.cc.length?global.settingSystem.mailReward.cc.join():"","Schedule ReWard User ---Error","Schedule ReWard User:"+a.email+"  raptornodes.com. Error"+e.toString()).then(()=>{console.log("")})});console.log("rawData",n);const o=new L.ReWardHistory;o.description=e;o.user=a;o.collateral=s;o.percentOfNode=i;o.feeReward=global.settingSystem.feeReward;if(l&&l._id){o.smartNode=l._id}o.feeHost=r;o.amount=parseFloat(t.toFixed(8));o.reward=x._id;o.days=x.days;o.dayEnd=x.dayEnd||new Date;o.txid=n;o.paymentsPerDay=global.settingSystem.paymentsPerDay;o.save();try{if(global.settingSystem&&global.settingSystem.mailReward&&global.settingSystem.mailReward.enable){U.default(a.email+(global.settingSystem.mailReward.cc.length?","+global.settingSystem.mailReward.cc.join():""),H.default.template(global.settingSystem.mailReward.label)({name:a.profile.name,email:a.email,avatar:a.profile.picture,data:""}),H.default.template(global.settingSystem.mailReward.template)({name:a.profile.name,email:a.email,avatar:a.profile.picture,data:""})).then(e=>{console.log("đàads")})}}catch(e){console.log(e)}return n});const u=yield z();if(u&&u.amount&&u.participants.length){try{for(var E=B(u.participants),o;o=yield E.next(),!o.done;){const c=o.value;if(c){const F=yield W(c.author,c.amount,c.amount/global.settingSystem.collateral);c.lastReward=new Date;c.txidLastReward=F;yield u.save()}}}catch(e){g={error:e}}finally{try{if(o&&!o.done&&(y=E.return))yield y.call(E)}finally{if(g)throw g.error}}u.lastReward=new Date;yield u.save()}try{for(var k=B(i),a;a=yield k.next(),!a.done;){const l=a.value;try{for(var M=(S=void 0,B(l.participants)),s;s=yield M.next(),!s.done;){const c=s.value;yield W(c.userId,c.collateral,c.percentOfNode,l)}}catch(e){S={error:e}}finally{try{if(s&&!s.done&&(b=M.return))yield b.call(M)}finally{if(S)throw S.error}}l.lastReward=new Date;l.save()}}catch(e){w={error:e}}finally{try{if(a&&!a.done&&(v=k.return))yield v.call(k)}finally{if(w)throw w.error}}try{const d=yield J.System.findOne();d.missingReward=false;d.save()}catch(e){}}}catch(e){throw new q.ApolloError("Error"+e.toString());console.log("fixx",e)}});const g=()=>{if(m){m.stop()}const e=global.settingSystem.scheduleDay==="Everyday"?"*":global.settingSystem.scheduleDay;const t=global.settingSystem.scheduleTime.split(":")[1];const r=global.settingSystem.scheduleTime.split(":")[0];console.log("scheduleReward ",`${t} ${r} * * ${e}`,global.settingSystem.scheduleDay,global.settingSystem.scheduleTime,global.settingSystem.scheduleValue);try{if(r||t){m=n.schedule(`${t} ${r} * * ${e}`,()=>j(void 0,void 0,void 0,function*(){const e=new s.ReWard;console.log("vào đây trả thưởng ");e.isSchedule=false;e.paymentsPerDay=global.settingSystem.paymentsPerDay;e.feeReward=global.settingSystem.feeReward;const t=yield s.ReWard.findOne().sort({createdAt:-1}).exec();e.dayEnd=new Date;if(t){e.days=parseInt(""+(t.dayEnd.getTime()+6e5-e.dayEnd.getTime())/(1e3*60*60*24))}else{e.days=global.settingSystem.scheduleDay!=="Everyday"&&global.settingSystem.scheduleDay2&&global.settingSystem.scheduleDay2!=="NoUse"?4:global.settingSystem.scheduleValue}const r="ReWard in Raptornodes.com";e.description=r;yield e.save();i(e).then()}));if(global.settingSystem.scheduleDay!=="Everyday"&&global.settingSystem.scheduleDay2&&global.settingSystem.scheduleDay2!=="NoUse"){if(h){h.stop()}h=n.schedule(`${t} ${r} * * ${e}`,()=>j(void 0,void 0,void 0,function*(){const e=new s.ReWard;console.log("vào đây trả thưởng 2 ");e.isSchedule=false;e.paymentsPerDay=global.settingSystem.paymentsPerDay;e.feeReward=global.settingSystem.feeReward;const t=yield s.ReWard.findOne().sort({createdAt:-1}).exec();e.dayEnd=new Date;if(t){e.days=parseInt(""+(t.dayEnd.getTime()+6e5-e.dayEnd.getTime())/(1e3*60*60*24))}else{e.days=3}const r="ReWard in Raptornodes.com";e.description=r;yield e.save();i(e).then()}))}}}catch(e){console.log(e)}};let y="";const w=()=>j(void 0,void 0,void 0,function*(){var t,e;const r={status:"Pending"};if(global.settingSystem.withdrawWeeklyConfirm){r.confirm=true}const n=yield l.WithdrawWeekly.find(r);try{for(var o=B(n),a;a=yield o.next(),!a.done;){const s=a.value}}catch(e){t={error:e}}finally{try{if(a&&!a.done&&(e=o.return))yield e.call(o)}finally{if(t)throw t.error}}});if(!process.env.NODE_APP_INSTANCE||process.env.NODE_APP_INSTANCE==="0"){setTimeout(()=>{y=global.settingSystem.scheduleDay+global.settingSystem.scheduleTime+global.settingSystem.scheduleValue+"fff";g()},8e3)}const v=()=>j(void 0,void 0,void 0,function*(){const e=global.settingSystem?global.settingSystem.testNet:false;const t=global.settingSystem.paymentsPerDay;const r=yield J.System.findOne();if(r){global.settingSystem=r}else{global.settingSystem=u.default}global.settingSystem.testNet=e;const n=global.settingSystem.scheduleDay+global.settingSystem.scheduleTime+global.settingSystem.scheduleValue+"fff";if(y!==n){console.log("Có thay đổi cần xử lý lại");y=n;try{if(!process.env.NODE_APP_INSTANCE||process.env.NODE_APP_INSTANCE==="0"){g()}}catch(e){console.log(e)}}global.settingSystem.rewardAccount="Reward";if(!global.settingSystem.rewardAddress||global.settingSystem.rewardAddress==""){const a=yield C.getAccountAddress("Reward").catch(e=>{console.log("không thể kết nối raptoreum",e.toString());return false});if(a){global.settingSystem.rewardAddress=a;global.settingSystem.rewardAccount="Reward";if(r){r.rewardAddress=a;yield r.save()}}}const o=yield C.smartnodeCount();if(o&&o.total){r.paymentsPerDay=72e4/o.enabled}else if(t){r.paymentsPerDay=t}});setInterval(()=>{console.log("setInterval");v()},2e4);const S={Query:{rewards:(e,t,r)=>j(void 0,void 0,void 0,function*(){try{c.checkIsAuthen(r.user);const e=yield s.ReWard.find({});return e}catch(e){throw new q.ApolloError(e)}})},Mutation:{createReward:(e,o,a)=>j(void 0,void 0,void 0,function*(){try{c.checkIsAdmin(a.user);const e=new s.ReWard;e.isSchedule=false;e.paymentsPerDay=global.settingSystem.paymentsPerDay;e.feeReward=global.settingSystem.feeReward;e.days=o.days;const t=yield s.ReWard.findOne().sort({createdAt:-1}).exec();e.dayEnd=o.dayEnd||new Date;if(t){e.days=parseInt(""+(t.dayEnd.getTime()-e.dayEnd.getTime())/(1e3*60*60*24))}const r="ReWard in Raptornodes.com";e.description=o.description||r;if(a.user.enableTfa){if(!o.tfa||o.tfa===""){throw new q.ApolloError("undefined code 2fa")}const n=d.default.totp.verify({secret:a.user.tfa.secret,encoding:"base32",token:o.tfa});if(!n){throw new q.ApolloError("2fa is not correct")}}e.save();yield i(e);return e}catch(e){throw new q.ApolloError(e)}}),tryReward:(e,r,n)=>j(void 0,void 0,void 0,function*(){try{c.checkIsAdmin(n.user);const e=yield s.ReWard.findById(r._id);if(!e){throw new q.ApolloError("Not found ReWard")}if(!e.missingReward){throw new q.ApolloError("ReWard not Missing")}if(global.settingSystem.isMaintenance){throw new q.ApolloError("System is Maintenance")}if(n.user.enableTfa){if(!r.tfa||r.tfa===""){throw new q.ApolloError("undefined code 2fa")}const t=d.default.totp.verify({secret:n.user.tfa.secret,encoding:"base32",token:r.tfa});if(!t){throw new q.ApolloError("2fa is not correct")}}yield i(e);return e}catch(e){throw new q.ApolloError(e)}})}};o["default"]=S},3950:function(d,e,t){"use strict";var n=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const o=t(6055);const a=t(6609);const s=t(4103);const i=r(t(8351));const l={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const u=new i.default(l);const c={Query:{rewardHistorys:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{s.checkIsAuthen(r.user);if(r.user.rules==="Admin"){return yield a.ReWardHistory.find(t).populate("user")}const e=yield a.ReWardHistory.find({user:r.user._id});return e}catch(e){throw new o.ApolloError(e)}})},Mutation:{}};e["default"]=c},3876:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};Object.defineProperty(t,"__esModule",{value:true});const o=r(6055);const a={Query:{getRoi:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{console.log(r);const e=[{name:"xyz"},{name:"abc"}];return e}catch(e){throw new o.ApolloError(e)}}),getAllRoi:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{console.log(r.user);const e=[{name:"xyz"},{name:"abc"}];return e}catch(e){throw new o.ApolloError(e)}})}};t["default"]=a},7796:function(s,e,t){"use strict";var l=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const c=t(6055);const n=r(t(8351));const o=r(t(6517));const d=t(4103);const a=t(6609);const i=t(9970);const f={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const u=new n.default(f);const p={Query:{getBalance:(e,t,o)=>l(void 0,void 0,void 0,function*(){try{d.checkIsAuthen(o.user);const e=yield u.getbalance(o.user.accountRTM);const r=yield u.getreceivedbyaccount(o.user.accountRTM);console.log(r,e);let t=0;const n=yield a.ReWardHistory.find({user:o.user._id});n.forEach(e=>{t+=e.amount});return yield{balance:e,received:r,rewarded:t}}catch(e){throw new c.ApolloError(e)}}),getBalanceByAddress:(e,t,r)=>l(void 0,void 0,void 0,function*(){try{return yield u.getAddressBalance(t.address)}catch(e){throw new c.ApolloError(e)}}),lastTxid:(e,t,r)=>l(void 0,void 0,void 0,function*(){try{d.checkIsAuthen(r.user);const e=yield u.getaddresstxids(r.user.accountRTM);if(e.length===0){return""}return e[e.length-1].txid}catch(e){throw new c.ApolloError(e)}}),getInfoRTM:(e,t,r)=>l(void 0,void 0,void 0,function*(){try{d.checkIsAdmin(r.user);const e=yield u.getblockchaininfo();const t=yield u.getwalletinfo();console.log(t,"res2",o.default.merge(e,t));return o.default.merge(e,t)}catch(e){throw new c.ApolloError(e)}}),transactions:(e,o,a)=>l(void 0,void 0,void 0,function*(){try{d.checkIsAuthen(a.user);const e=o.count;const t=o.skip;const r=a.user.rules==="Admin"?[o.account?o.account:null,e,t]:[a.user.accountRTM,e,t];const n=yield u.listtransactions(r);console.log(o.time);if(o.category){return n.filter(e=>e.category===o.category)}return n}catch(e){throw new c.ApolloError(e)}}),reWardBalancePending:(e,s,i)=>l(void 0,void 0,void 0,function*(){try{d.checkIsAuthen(i.user);const e=s.count;const r=s.skip;const n=[global.settingSystem.rewardAccount,e,r];const o=yield u.listtransactions(n);const a=o.filter(e=>e&&e.amount&&e.confirmations<101);let t=0;console.log(a);a.forEach(e=>{t+=e.amount});return t}catch(e){throw new c.ApolloError(e)}}),getblockcount:(e,t,r)=>l(void 0,void 0,void 0,function*(){const e=yield i.getblockcount(global.settingSystem.testNet);return e.data}),listaddressgroupings:(e,t,n)=>l(void 0,void 0,void 0,function*(){try{d.checkIsAdmin(n.user);const t=yield u.listaddressgroupings();console.log(t,"objDa");const r=[];Object.keys(t).forEach(e=>{r.push({account:e,balance:t[e]})});return yield r}catch(e){throw new c.ApolloError(e)}}),listaccounts:(e,t,n)=>l(void 0,void 0,void 0,function*(){try{d.checkIsAdmin(n.user);const t=yield u.listaccounts();const r=[];Object.keys(t).forEach(e=>{r.push({account:e,balance:t[e]})});return yield r}catch(e){throw new c.ApolloError(e)}})}};e["default"]=p},5047:function(o,e,t){"use strict";var n=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const l=t(6055);const a=r(t(8351));const c=r(t(9200));const d=r(t(7352));const u=t(4103);const f=t(5069);const m=r(t(6517));const h=t(1325);const g=t(849);const s={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const p=new a.default(s);const i={Query:{smartNodeEnough:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{const e=yield f.SmartNode.findOne({statusCollateral:"Not Enough"}).populate("participants.userId");return e}catch(e){throw new l.ApolloError(e)}}),smartNodes:(e,t,o)=>n(void 0,void 0,void 0,function*(){try{u.checkIsAuthen(o.user);const e=yield f.SmartNode.find().populate("participants.userId");const r=yield p.smartnodelist();const n={};Object.keys(r).forEach(e=>{const t=r[e].address.replace(":10227","").replace(":10226","");n[t]=r[e];n[t].ipAddress=t});const t=yield p.listaccounts().catch(()=>{return{}});return e.map(e=>{if(n[e.ipAddress]){n[e.ipAddress].label=e.label;n[e.ipAddress]._id=e._id;n[e.ipAddress].createdAt=e.createdAt;n[e.ipAddress].updatedAt=e.updatedAt;n[e.ipAddress].collateral=e.collateral;n[e.ipAddress].lastReward=e.lastReward;n[e.ipAddress].balance=t[e.privateAccount]||0;n[e.ipAddress].privateAccount=e.privateAccount;n[e.ipAddress].privateAddress=e.privateAddress;n[e.ipAddress].statusCollateral=e.statusCollateral;n[e.ipAddress].participants=e.participants;return Object.assign(Object.assign({},n[e.ipAddress]),e)}e.balance=t[e.privateAccount]||0;return e})}catch(e){console.log("dddd",e);throw new l.ApolloError(e)}}),myNodes:(e,t,o)=>n(void 0,void 0,void 0,function*(){try{u.checkIsAuthen(o.user);const e=yield f.SmartNode.find().populate("participants.userId");const r=yield p.smartnodelist();const n={};Object.keys(r).forEach(e=>{const t=r[e].address.replace(":10227","").replace(":10226","");n[t]=r[e];n[t].ipAddress=t});return e.filter(e=>e.participants.filter(e=>e.userId&&typeof e.userId==="object"&&o.user._id.equals(e.userId._id)).length!==0).map(e=>{if(n[e.ipAddress]){n[e.ipAddress].label=e.label;n[e.ipAddress]._id=e._id;n[e.ipAddress].createdAt=e.createdAt;n[e.ipAddress].updatedAt=e.updatedAt;n[e.ipAddress].collateral=e.collateral;n[e.ipAddress].lastReward=e.lastReward;n[e.ipAddress].privateAddress=e.privateAddress;n[e.ipAddress].privateAccount=e.privateAccount;n[e.ipAddress].statusCollateral=e.statusCollateral;n[e.ipAddress].participants=e.participants;return Object.assign(Object.assign({},n[e.ipAddress]),e)}return e})}catch(e){console.log(e);throw new l.ApolloError(e)}}),getSmartNodes:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{const e=yield f.SmartNode.find();const r=yield p.smartnodelist();const n={};Object.keys(r).forEach(e=>{const t=r[e].address.replace(":10227","").replace(":10226","");n[t]=r[e];n[t].ipAddress=t});return e.map(e=>{if(n[e.ipAddress]){n[e.ipAddress].label=e.label;n[e.ipAddress]._id=e._id;n[e.ipAddress].createdAt=e.createdAt;n[e.ipAddress].updatedAt=e.updatedAt;n[e.ipAddress].collateral=e.collateral;n[e.ipAddress].privateAddress=e.privateAddress;n[e.ipAddress].statusCollateral=e.statusCollateral;n[e.ipAddress].participants=e.participants;return Object.assign(Object.assign({},n[e.ipAddress]),e)}return e})}catch(e){throw new l.ApolloError(e)}}),smartnodeCount:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{console.log(r);const e=yield p.smartnodeCount();return e}catch(e){throw new l.ApolloError(e)}})},Mutation:{createSmartNode:(e,a,s)=>n(void 0,void 0,void 0,function*(){u.checkIsAdmin(s.user);const e=new f.SmartNode;e.label=a.label;e.ipAddress=a.ipAddress||"";if(global.settingSystem.isMaintenance){throw new l.ApolloError("System is Maintenance")}if(a.participants){e.participants=a.participants}else{e.participants=[]}e.private=false;if(a.private||a.private===false){e.private=a.private}const t=yield f.SmartNode.find({label:e.label});if(t&&t.length){throw new l.ApolloError("Label not unique")}let r="User#"+e.label;const n=yield p.getAddressesByAccount(r);if(n&&n.length){r="User#"+e.label+"_"+(new Date).getTime()}const o=yield p.getAccountAddress(r).catch(e=>{console.log("không thể kết nối raptoreum",e.toString());return false});e.privateAddress=o;e.privateAccount="SmartNode#"+e.label;e.collateral=global.settingSystem.collateral||15e5;if(a.showParticipants||a.showParticipants===false){e.showParticipants=a.showParticipants}if(a.collateral){e.collateral=a.collateral}e.statusCollateral="Not Enough";if(a.statusCollateral){e.statusCollateral=a.statusCollateral}e.save();return e}),updateSmartNode:(e,r,t)=>n(void 0,void 0,void 0,function*(){u.checkIsAdmin(t.user);const e=yield f.SmartNode.findById(r._id);if(!e){throw new l.ApolloError("Not found document")}if(r.label){e.label=r.label}if(r.ipAddress){e.ipAddress=r.ipAddress}if(r.collateral&&e.collateral!==r.collateral){let t=0;e.collateral=r.collateral;e.participants.find(e=>{t+=e.collateral;e.percentOfNode=e.collateral/r.collateral});if(t>=e.collateral){e.statusCollateral="Enough"}}if(r.private||r.private===false){e.private=r.private}if(!e.privateAccount||e.privateAccount===""){e.privateAccount="SmartNode#"+e.label}if(r.showParticipants||r.showParticipants===false){e.showParticipants=r.showParticipants}if(r.statusCollateral&&r.statusCollateral!==e.statusCollateral){e.statusCollateral=r.statusCollateral;if(r.statusCollateral==="Start Reward"&&!e.timeStartReward){e.timeStartReward=new Date}}yield e.save();return e}),withdrawEnoughSmartNode:(e,a,s)=>n(void 0,void 0,void 0,function*(){u.checkIsAdmin(s.user);const e=yield f.SmartNode.findById(a._id);if(!e){throw new l.ApolloError("Not found document")}if(global.settingSystem.isMaintenance){throw new l.ApolloError("System is Maintenance")}if(!a.amount){throw new l.ApolloError("require amount")}if(!a.address||a.address===""){throw new l.ApolloError("require address")}if(s.user.enableTfa){if(!a.tfa||a.tfa===""){throw new l.ApolloError("undefined code 2fa")}const o=c.default.totp.verify({secret:s.user.tfa.secret,encoding:"base32",token:a.tfa});if(!o){throw new l.ApolloError("2fa is not correct")}}const t="sendTo address Smartnode "+e.label;let r=e.privateAccount;if(e.privateAccount&&e.privateAccount!==""){r=e.privateAccount}try{yield p.walletpassphrase(g.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const n=yield p.sendFrom({address:a.address,account:r,comment:t,amount:a.amount,comment_to:""});yield e.save();return e}),deleteSmartNode:(e,t,r)=>n(void 0,void 0,void 0,function*(){u.checkIsAdmin(r.user);throw new l.ApolloError("delete not allow");return true}),joinSmartNode:(e,s,i)=>n(void 0,void 0,void 0,function*(){u.checkIsAuthen(i.user);try{if(global.settingSystem&&global.settingSystem.mailJobSmartNode&&global.settingSystem.mailJobSmartNode.enable){d.default(i.user.email+(global.settingSystem.mailJobSmartNode.cc.length?","+global.settingSystem.mailJobSmartNode.cc.join():""),m.default.template(global.settingSystem.mailJobSmartNode.label)({name:i.user.profile.name,email:i.user.email,avatar:i.user.profile.picture,data:""}),m.default.template(global.settingSystem.mailJobSmartNode.template)({name:i.user.profile.name,email:i.user.email,avatar:i.user.profile.picture,data:""})).then(e=>{console.log("đàads")})}}catch(e){}if(!i.user.enableTfa){throw new l.ApolloError("You need to enable Two Factor Authentication")}if(global.settingSystem.isMaintenance){throw new l.ApolloError("System is Maintenance")}if(i.user.enableTfa){if(!s.token&&s.token===""){throw new l.ApolloError("Not verified 2FA")}const t=c.default.totp.verify({secret:i.user.tfa.secret,encoding:"base32",token:s.token});if(!t){throw new l.ApolloError("Not verified 2FA")}}const e=yield f.SmartNode.findById(s._id);if(!e){throw new l.ApolloError("Not Found SmartNode _id"+s._id)}if(e.statusCollateral!=="Not Enough"){throw new l.ApolloError("SmartNode:"+e.label+" is "+e.statusCollateral)}try{const r="#join SmartNode:#"+e.label+"- Raptornodes.com";try{yield p.walletpassphrase(g.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const n=yield p.sendFrom({address:e.privateAddress,account:i.user.accountRTM,comment:r,amount:s.amount,comment_to:""});if(n){const o=new h.Withdraw;o.address=e.privateAddress;o.amount=s.amount;o.description=r;o.author=i.user._id;o.txid=n;o.save();const a=e.participants.find(e=>e.userId&&typeof e.userId==="object"&&i.user._id.equals(e.userId._id));if(a){a.collateral+=s.amount;a.percentOfNode=a.collateral/e.collateral;a.txids.push(n);a.time=new Date}else{e.participants.push({userId:i.user._id,RTMRewards:0,collateral:s.amount,pendingRTMRewards:0,percentOfNode:s.amount/e.collateral,txids:[n],time:new Date})}let t=0;e.participants.forEach(e=>{t+=e.collateral});if(t>=e.collateral){e.statusCollateral="Enough"}yield e.save();return e}else{throw new l.ApolloError("Error 1234567")}}catch(e){throw new l.ApolloError("Error"+e.toString())}return{}}),widthDrawlSmartNode:(e,t,r)=>n(void 0,void 0,void 0,function*(){if(!r.user){throw new l.ApolloError("No session login")}if(global.settingSystem.isMaintenance){throw new l.ApolloError("System is Maintenance")}if(r.user.enableTfa){if(!t.token&&t.token===""){throw new l.ApolloError("Not verified 2FA")}const e=c.default.totp.verify({secret:r.user.tfa.secret,encoding:"base32",token:t.token});if(!e){throw new l.ApolloError("Not verified 2FA")}}try{d.default(r.user.email,"raptornodes.com - widthDrawl SmartNode","Hey! "+r.user.profile.name+", widthDrawl SmartNode #2 done. ").then(e=>{console.log(e)})}catch(e){}return true})},smartNode:{yourParticipant:(e,t,r)=>n(void 0,void 0,void 0,function*(){return e.participants.find(e=>e.userId&&typeof e.userId==="object"&&r.user._id.equals(e.userId._id))})}};e["default"]=i},8025:function(n,e,t){"use strict";var i=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const f=t(6055);const l=t(5533);const p=t(6833);const m=t(4103);const h=t(1185);const c=r(t(9200));const a=r(t(6878));const o=r(t(8351));const s=t(849);const d={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const g=new o.default(d);const u={Query:{rewardInfo:(e,t,n)=>i(void 0,void 0,void 0,function*(){try{m.checkIsAdmin(n.user);const e=global.settingSystem.rewardAddress;const t=yield g.getbalance(global.settingSystem.rewardAccount);const r=yield g.getreceivedbyaccount(global.settingSystem.rewardAccount);return{balance:t?t:0,received:r?r:0,rewardAddress:global.settingSystem.rewardAddress}}catch(e){throw new f.ApolloError(e)}}),withdrawlWeeklyInfoUser:(e,l,c)=>i(void 0,void 0,void 0,function*(){try{m.checkIsAuthen(c.user);const t={author:c.user._id,status:"Pending"};const r={author:c.user._id,status:"Done"};if(l.createdAt){t.createdAt={};r.createdAt={};Object.keys(l.createdAt).forEach(e=>{if(["eq","neq","ne","in","nin","gte","gt","lt","lte"].includes(e)){t.createdAt["$"+e]=l.createdAt[e];r.createdAt["$"+e]=l.createdAt[e]}})}const e=yield p.WithdrawWeekly.aggregate([{$match:t},{$group:{_id:null,count:{$sum:1},amount:{$sum:"$amount"}}}]).exec();const n=yield p.WithdrawWeekly.aggregate([{$match:r},{$group:{_id:null,count:{$sum:1},amount:{$sum:"$amount"}}}]).exec();const o=e&&e.length?e[0].amount:0;const a=e&&e.length?e[0].count:0;const s=n&&n.length?n[0].amount:0;const i=n&&n.length?n[0].count:0;return{withdrawlIsPending:o,withdrawlISPaid:s,withdrawlISPaidCount:i,withdrawlIsPendingCount:a}}catch(e){throw new f.ApolloError(e)}}),withdrawlWeeklyInfo:(e,d,u)=>i(void 0,void 0,void 0,function*(){try{m.checkIsAdmin(u.user);const t={status:"Pending"};const r={status:"Done"};if(d.author){t.author=new h.mongo.ObjectId(d.author||"");r.author=new h.mongo.ObjectId(d.author||"")}if(d.createdAt){t.createdAt={};r.createdAt={};Object.keys(d.createdAt).forEach(e=>{if(["eq","neq","ne","in","nin","gte","gt","lt","lte"].includes(e)){t.createdAt["$"+e]=d.createdAt[e];r.createdAt["$"+e]=d.createdAt[e]}})}const e=yield g.getbalance(global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly");const n=yield g.getreceivedbyaccount(global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly");const o=yield p.WithdrawWeekly.aggregate([{$match:t},{$group:{_id:null,count:{$sum:1},amount:{$sum:"$amount"}}}]).exec();const a=yield p.WithdrawWeekly.aggregate([{$match:r},{$group:{_id:null,count:{$sum:1},amount:{$sum:"$amount"}}}]).exec();console.log("withdrawWeeklys",o);const s=o&&o.length?o[0].amount:0;const i=o&&o.length?o[0].count:0;const l=a&&a.length?a[0].amount:0;const c=a&&a.length?a[0].count:0;return{weeklyFund:global.settingSystem.weeklyFund||0,balance:e?e:0,withdrawlIsPending:s,withdrawlISPaid:l,withdrawlISPaidCount:c,withdrawlIsPendingCount:i,received:n?n:0,address:global.settingSystem.withdrawWeeklyAddress}}catch(e){throw new f.ApolloError(e)}}),settingSystem:(e,t,o)=>i(void 0,void 0,void 0,function*(){try{m.checkIsAdmin(o.user);const e=yield l.System.find();if(e.length===0){const r=a.default;const n=new l.System(r);yield n.save();return n}const t=e[0];t.paymentsPerDay=settingSystem.paymentsPerDay;return t}catch(e){throw new f.ApolloError(e)}}),variableSystem:(e,t,r)=>i(void 0,void 0,void 0,function*(){try{if(global.settingSystem){return global.settingSystem}const e=yield l.System.find();if(e.length===0){const t=a.default;return t}return e[0]}catch(e){throw new f.ApolloError(e)}})},Mutation:{sendByAccount:(e,r,n)=>i(void 0,void 0,void 0,function*(){m.checkIsAdmin(n.user);if(n.user.enableTfa){if(!r.tfa||r.tfa===""){throw new f.ApolloError("undefined code 2fa")}const t=c.default.totp.verify({secret:n.user.tfa.secret,encoding:"base32",token:r.tfa});if(!t){throw new f.ApolloError("2fa is not correct")}}try{yield g.walletpassphrase(s.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const e=yield g.sendFrom({address:r.address,account:r.account,comment:"RAW",amount:r.amount,comment_to:""});return e}),updateSystem:(e,a,s)=>i(void 0,void 0,void 0,function*(){try{m.checkIsAdmin(s.user);if(s.user.enableTfa){if(!a.tfa||a.tfa===""){throw new f.ApolloError("undefined code 2fa")}const n=c.default.totp.verify({secret:s.user.tfa.secret,encoding:"base32",token:a.tfa});if(!n){throw new f.ApolloError("2fa is not correct")}}let e=yield l.System.findOne();if(!e){e=new l.System}if(a.enableWithdraw||a.enableWithdraw===false){e.enableWithdraw=a.enableWithdraw}if(a.scheduleTime){e.scheduleTime=a.scheduleTime}if(a.scheduleDay){e.scheduleDay=a.scheduleDay}if(a.scheduleDay){e.scheduleDay=a.scheduleDay;if(e.scheduleDay==="Everyday"){e.scheduleDay2="NoUse"}}if(a.scheduleDay2){e.scheduleDay2=a.scheduleDay2}if(a.scheduleValue){e.scheduleValue=a.scheduleValue}if(a.collateral){e.collateral=a.collateral}if(a.collateralMin||a.collateralMin){e.collateralMin=a.collateralMin}if(a.feeReward||a.feeReward){e.feeReward=a.feeReward}if(a.paymentsPerDay||a.paymentsPerDay){e.paymentsPerDay=a.paymentsPerDay}if(a.mailTfa){e.mailTfa=a.mailTfa}if(a.mailJobSmartNode){e.mailJobSmartNode=a.mailJobSmartNode}if(a.mailReward){e.mailReward=a.mailReward}if(a.mailWellcome){e.mailWellcome=a.mailWellcome}if(a.mailNewSession){e.mailNewSession=a.mailNewSession}if(a.mailWithdraw){e.mailWithdraw=a.mailWithdraw}if(a.mailDespost){e.mailDespost=a.mailDespost}if(a.withdrawWeekly||a.withdrawWeekly===false){e.withdrawWeekly=a.withdrawWeekly}if(a.withdrawWeeklyConfirm||a.withdrawWeeklyConfirm===false){e.withdrawWeeklyConfirm=a.withdrawWeeklyConfirm}if(a.withdrawWeeklyMinimum||a.withdrawWeeklyMinimum===0){e.withdrawWeeklyMinimum=a.withdrawWeeklyMinimum}if(a.withdrawWeeklyScheduleTime||a.withdrawWeeklyScheduleTime===""){e.withdrawWeeklyScheduleTime=a.withdrawWeeklyScheduleTime}if(a.weeklyFund){e.weeklyFund=a.weeklyFund}if(a.isMaintenance||a.isMaintenance===false){e.isMaintenance=a.isMaintenance}yield e.save();const t=global.settingSystem.testNet;const r=global.settingSystem.rewardAddress;global.settingSystem=e;global.settingSystem.withdrawlWeeklyAccount="WithdrawlWeekly";global.settingSystem.rewardAccount="Reward";global.settingSystem.testNet=t;if(!r||r===""){try{const o=yield g.getAccountAddress("Reward").catch(e=>{console.log("không thể kết nối raptoreum",e.toString());return false});global.settingSystem.testNet=t;if(o){global.settingSystem.rewardAddress=o;global.settingSystem.rewardAccount="Reward"}}catch(e){}}else{global.settingSystem.rewardAddress=r}return e}catch(e){throw new f.ApolloError(e)}})}};e["default"]=u},1179:function(c,e,t){"use strict";var a=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const s=t(6055);const i=r(t(9200));const l=t(2656);const o=r(t(7352));const n={Mutation:{getTfa:(e,t,r)=>a(void 0,void 0,void 0,function*(){try{return{tempSecret:"",dataURL:"",tfaURL:""}}catch(e){throw new s.ApolloError(e)}}),setupTfa:(e,t,o)=>a(void 0,void 0,void 0,function*(){try{if(!o.user){throw new s.ApolloError("No session login")}if(o.user.tfa&&o.user.tfa.dataURL&&o.user.tfa.dataURL!==""&&o.user.tfa.tempSecret!==""){return o.user.tfa}const e=i.default.generateSecret({length:10,name:o.user?o.user.email:"huyquansu96@gmail.com",issuer:"Raptornodes v1.1"+(process.env.TESTNET==="1"?"- testnet":"")});const t=i.default.otpauthURL({secret:e.base32,label:o.user?o.user.email:"huyquansu96@gmail.com",issuer:"Raptornodes v1.1"+(process.env.TESTNET==="1"?"- testnet":""),encoding:"base32"});console.log("url",t);const n={tempSecret:e.base32,dataURL:t,tfaURL:e.otpauth_url};if(o.user.save){o.user.tfa=n;o.user.save()}else{new Promise(r=>{l.User.findById(o.user.id,(e,t)=>{t.tfa=n;t.save();r(t)})})}return{tempSecret:e.base32,dataURL:t,tfaURL:e.otpauth_url}}catch(e){throw new s.ApolloError(e)}}),verifyTfa:(e,n,t)=>a(void 0,void 0,void 0,function*(){try{if(!t.user){throw new s.ApolloError("No session login")}const e=i.default.totp.verify({secret:t.user.tfa.tempSecret,encoding:"base32",token:n.token});if(e){console.log("DEBUG: TFA is verified to be enabled");if(t.user.save){console.log("vào đây",t.user.id);t.user.tfa.secret=t.user.tfa.tempSecret;t.user.tfa.tempSecret="";t.user.tfa.dataURL="";t.user.tfa.done=new Date;t.user.enableTfa=n.enable===false?false:true;t.user.save(e=>{console.log(e)})}else{new Promise(r=>{l.User.findById(t.user.id,(e,t)=>{t.tfa.secret=t.tfa.tempSecret;t.tfa.done=new Date;t.enableTfa=n.enable===false?false:true;t.save(e=>{console.log(e)});r(t)})})}try{o.default(t.user.email,"raptornodes.com - 2FA enabled","Hey! "+t.user.profile.name+" 2FA is enabled, You can rest assured on raptornodes.com, every action needs your confirmation by 2FA.").then(e=>{console.log(e)})}catch(e){}return true}else{throw new s.ApolloError("Not verified 2FA")}}catch(e){throw new s.ApolloError(e)}})}};e["default"]=n},3167:function(n,e,t){"use strict";var r=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var D=this&&this.__asyncValues||function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=o[Symbol.asyncIterator],t;return e?e.call(o):(o=typeof __values==="function"?__values(o):o[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=o[n]&&function(r){return new Promise(function(e,t){r=o[n](r),a(e,t,r.done,r.value)})}}function a(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}};var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const O=t(6055);const j=t(5492);const B=t(4103);const a=o(t(8351));const q=o(t(9200));const I=t(2656);const P=t(6833);const U=t(5069);const W=t(849);const s=t(2073);const i={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const F=new a.default(i);const x=()=>r(void 0,void 0,void 0,function*(){const e=yield s.DataUltraFastEarning.find();if(e.length===0){const t={amount:0,status:"Enough",description:""};const r=new s.DataUltraFastEarning(t);yield r.save();return r}return e[0]});let k=false;setInterval(()=>r(void 0,void 0,void 0,function*(){var r,u,n,f;console.log("check withdrawl weekly");k=true;const t=yield P.WithdrawWeekly.find({status:"waitForPayment"});if(t&&t.length){try{for(const a of t){yield new Promise(e=>{setTimeout(()=>{e(true),2e3})});const g=yield F.getbalance(global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly");if(g>=a.amount){const y=yield I.User.findById(a.author);try{yield F.walletpassphrase(W.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const w=yield F.sendFrom({address:y.addressRTM,account:global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly",comment:"WithdrawlWeekly in Raptornodes.com",amount:a.amount,comment_to:""});if(w){a.status="Done";a.txid=w;yield a.save()}}}}catch(e){console.log("e",e)}}console.log("dataUFEf");const p=yield x();console.log(p);if(p&&p.participants.length){const v=yield P.WithdrawWeekly.find({status:"Pending"});const S=(e,r)=>{let n=0;const o=[];e.some(e=>{if(r.amount<=n+e.amount){n+=e.amount;o.push({ultraFastEarnings:e.ultraFastEarnings,txids:e.txids,author:e.author,full:true,amount:e.amount,change:0,timeEchange:new Date})}else{if(r.amount<n){const t={ultraFastEarnings:e.ultraFastEarnings,txids:e.txids,author:e.author,full:true,amount:r.amount-n,change:e.amount-(r.amount-n),timeEchange:new Date};o.push(t);n+=t.amount}return true}});return{total:n,participants:e}};if(v&&v.length){try{for(const a of v){yield new Promise(e=>{setTimeout(()=>{e(true),500})});const s=yield x();const g=yield F.getbalance(global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly");if(g>=a.amount){let t={total:0,participants:[]};if(a.amount>=s.participants[0].amount){t=S(s.participants,s)}else{const b=s.participants.sort((e,t)=>e.amount-t.amount);if(a.amount>=b[0].amount){t=S(b,s)}else{}}if(t.participants.length&&t.total===a.amount){try{for(var m=(r=void 0,D(t.participants)),e;e=yield m.next(),!e.done;){const _=e.value;yield new Promise(e=>{setTimeout(()=>{e(true)},500)});const y=yield I.User.findById(a.author);try{yield F.walletpassphrase(W.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const A=yield F.sendFrom({address:y.addressRTM,account:global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly",comment:"WithdrawlWeekly in Raptornodes.com",amount:a.amount,comment_to:""});if(A){a.status="Done";a.txid=A;a.ultraFastEarning=_.ultraFastEarnings?_.ultraFastEarnings[_.ultraFastEarnings.length-1]:"";yield a.save();const i=yield U.SmartNode.findById(a.smartNode);console.log(i,"444smartNode");const l=i.participants.find(e=>e.userId&&typeof e.userId==="object"&&a.author===e.userId._id);console.log("withdrawParticipant222",l);if(l){l.collateral-=a.amount;l.txids.push(A);l.percentOfNode=l.collateral/i.collateral;l.exchange=(l.exchange||0)-a.amount;l.time=new Date;yield i.save()}let e=0;try{for(var h=(n=void 0,D(s.participants)),o;o=yield h.next(),!o.done;){const c=o.value;const E=t.participants.find(e=>e.author===c.author);if(E){if(E.full){c.amount=0}else{c.amount=E.change}const d=i.participants.find(e=>e.userId&&typeof e.userId==="object"&&c.author===e.userId._id);if(d){d.collateral+=c.amount;d.txids=d.txids.concat(c.txids);d.percentOfNode=d.collateral/i.collateral;d.time=new Date}else{i.participants.push({userId:c.author,RTMRewards:0,collateral:c.amount,pendingRTMRewards:0,percentOfNode:c.amount/i.collateral,txids:c.txids,time:new Date})}}e+=c.amount;yield i.save()}}catch(e){n={error:e}}finally{try{if(o&&!o.done&&(f=h.return))yield f.call(h)}finally{if(n)throw n.error}}s.participants=s.participants.filter(e=>e.amount);s.amount=e;yield s.save()}}}catch(e){r={error:e}}finally{try{if(e&&!e.done&&(u=m.return))yield u.call(m)}finally{if(r)throw r.error}}}}}}catch(e){}}}k=false}),18e4);const l={Query:{ultraFastEarnings:(n,o,a)=>r(void 0,void 0,void 0,function*(){try{B.checkIsAuthen(a.user);const t=a.user.rules==="Admin"?{}:{author:a.user._id};if(o.status){t.status=o.status}if(o.smartNode){t.smartNode=o.smartNode}if(a.user.rules==="Admin"&&o.author){t.author=o.author}if(o.createdAt){t.createdAt={};Object.keys(o.createdAt).forEach(e=>{if(["eq","neq","ne","in","nin","gte","gt","lt","lte"].includes(e)){t.createdAt["$"+e]=o.createdAt[e]}})}const e=yield j.UltraFastEarning.find(t).populate("author");const r=yield F.listtransactions([a.user.accountRTM]);console.log(o,n);e.forEach(t=>{const e=r.find(e=>e.txid===t.txid);if(e){t.fee=e.fee;t.blockhash=e.blockhash;t.confirmations=e.confirmations;t.time=e.time;t.timereceived=e.timereceived}});return e}catch(e){throw new O.ApolloError(e)}})},Mutation:{createUltraFastEarning:(e,N,T)=>r(void 0,void 0,void 0,function*(){var u,f;try{B.checkIsAuthen(T.user);const e=yield F.getbalance(global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly");const m=yield F.getbalance(T.user.accountRTM);const r=yield P.WithdrawWeekly.aggregate([{$match:{status:"Pending"}},{$group:{_id:null,count:{$sum:1},amount:{$sum:"$amount"}}}]).exec();const h=r.length?r[0].amount:0;const g=(global.settingSystem.weeklyFund||0)+h-(e>(global.settingSystem.weeklyFund||0)?global.settingSystem.weeklyFund||0:e);if(N.amount>m){throw new O.ApolloError("\n"+"Not enough money, please enter a maximum of!"+m.toFixed(8)+" RTM")}if(N.amount>g){throw new O.ApolloError("\n"+"The amount is too large, please enter a maximum of!"+g.toFixed(8)+" RTM")}if(global.settingSystem&&global.settingSystem.enableWithdraw===false){throw new O.ApolloError("The system is maintenance!!")}if(global.settingSystem.isMaintenance){throw new O.ApolloError("System is Maintenance")}const n=new j.UltraFastEarning;n.address=global.settingSystem.withdrawWeeklyAddress;n.amount=N.amount;n.status="Processing";const y="UFE in Raptornodes.com";n.description=N.description||y;n.author=T.user._id;if(!T.user.enableTfa){throw new O.ApolloError("You need to enable Two Factor Authentication")}if(T.user.enableTfa){if(!N.tfa||N.tfa===""){throw new O.ApolloError("undefined code 2fa")}const w=q.default.totp.verify({secret:T.user.tfa.secret,encoding:"base32",token:N.tfa});if(!w){throw new O.ApolloError("2fa is not correct")}}try{try{yield F.walletpassphrase(W.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const v=yield F.sendFrom({address:global.settingSystem.withdrawWeeklyAddress,account:T.user.accountRTM,comment:y,amount:N.amount,comment_to:""});if(!v){throw new O.ApolloError("send RTM correct")}n.txid=v;n.participants=[];const S=yield n.save();const r=yield P.WithdrawWeekly.find({status:"Pending"}).sort({createdAt:1}).exec();console.log("withdrawWeeklys",r);if(r.length){const b=r[0];const _=e=>{let t=0;const r=[];e.some(e=>{if(n.amount>t+e.amount){t+=e.amount;r.push({smartNode:e.smartNode,author:e.author,collateralOld:e.collateralOld,collateralNew:e.collateralOld-e.amount,exchange:e.amount,_idWithdrawWeekly:e._id,timeEchange:new Date})}else{return true}});return{total:t,participants:r}};let e={total:0,participants:[]};if(n.amount>=b.amount){e=_(r)}else{const A=r.sort((e,t)=>e.amount-t.amount);if(n.amount>=A[0].amount)e=_(A)}if(e.participants.length){n.swap=true;n.inFund=false;try{for(var p=D(e.participants),t;t=yield p.next(),!t.done;){const o=t.value;yield new Promise(e=>{setTimeout(()=>{e(true)},500)});const a=yield U.SmartNode.findById(o.smartNode);console.log(a,"smartNode");const s=a.participants.find(e=>e.userId&&typeof e.userId==="object"&&o.author.equals(e.userId._id));console.log("withdrawParticipant",s);if(s){s.collateral-=o.exchange;s.txids.push(n.txid);s.percentOfNode=s.collateral/a.collateral;s.exchange=(s.exchange||0)-o.exchange;s.time=new Date}const i=a.participants.find(e=>e.userId&&typeof e.userId==="object"&&T.user._id.equals(e.userId._id));if(i){i.collateral+=o.exchange;i.txids.push(n.txid);i.percentOfNode=i.collateral/a.collateral;i.time=new Date}else{a.participants.push({userId:T.user._id,RTMRewards:0,collateral:o.exchange,pendingRTMRewards:0,percentOfNode:o.exchange/a.collateral,txids:[n.txid],time:new Date})}yield a.save();const l=yield P.WithdrawWeekly.findById(o._idWithdrawWeekly);l.status="waitForPayment";l.ultraFastEarning=n._id;yield l.save();const E=yield F.getbalance(global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly");if(E>=l.amount){const k=yield I.User.findById(o.author);if(k){try{yield F.walletpassphrase(W.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const M=yield F.sendFrom({address:global.settingSystem.withdrawWeeklyAddress,account:k.accountRTM,comment:"WithdrawlWeekly in Raptornodes.com",amount:N.amount,comment_to:""});if(M){l.status="Done";l.txid=M;yield l.save()}}else{console.log("error not auth")}}}}catch(e){u={error:e}}finally{try{if(t&&!t.done&&(f=p.return))yield f.call(p)}finally{if(u)throw u.error}}n.participants=e.participants;console.log("haha222",e,n);if(n.amount-e.total>0){const c=yield x();console.log(c,"2dataUFE",JSON.stringify(c));const d=c.participants.find(e=>{T.user._id.equals(e.author)});if(d){d.txids.push(v);d.time=new Date;d.amount+=(n.amount||0)-e.total;d.ultraFastEarnings.push(n._id)}else{const R={time:new Date,amount:n.amount-e.total,txids:[v],ultraFastEarnings:[n._id],author:T.user._id};c.participants.push(R)}let t=0;c.participants.forEach(e=>{t+=e.amount});c.amount=t;yield c.save()}}else{n.swap=false;n.inFund=true}}else{n.swap=false;n.inFund=true}yield n.save();try{if(global.settingSystem&&global.settingSystem.mailWithdraw&&global.settingSystem.mailWithdraw.enable){}}catch(e){console.log(e)}return S}catch(e){throw new O.ApolloError("Error"+e.toString());console.log("fixx",e)}return n}catch(e){throw new O.ApolloError(e)}})}};e["default"]=l},6249:function(d,e,t){"use strict";var a=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const s=t(6055);const o=r(t(4159));const i=t(2656);const l=t(4103);const c=r(t(9200));const n=r(t(8351));const u=t(5069);const f={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const p=new n.default(f);const m={Query:{me:(e,t,r)=>a(void 0,void 0,void 0,function*(){try{if(!r.user){throw new s.ApolloError("No session login")}return o.default(r.user,["email","_id","profile","discord","createdAt","rules","updatedAt","addressRTM","enableTfa"])}catch(e){throw new s.ApolloError(e)}}),users:(e,t,o)=>a(void 0,void 0,void 0,function*(){try{l.checkIsAdmin(o.user);const e=yield i.User.find();const t=yield p.listaccounts().catch(()=>{return{}});const r=yield u.SmartNode.find({}).populate("participants.userId");const n={};r.forEach(e=>{e.participants.forEach(e=>{if(e.userId&&e.userId._id){n[e.userId._id]=e.collateral+(n[e.userId._id]||0)}})});if(t&&typeof t==="object"){e.forEach(e=>{e.collateral=n[e._id]||0;e.balance=t[e.accountRTM]||0;e.portfolio=e.balance+e.collateral})}return e}catch(e){throw new s.ApolloError(e)}})},Mutation:{updateUser:(e,r,n)=>a(void 0,void 0,void 0,function*(){try{if(!n.user){throw new s.ApolloError("No session login")}l.checkIsAdmin(n.user);if(n.user.enableTfa){if(!r.tfa||r.tfa===""){throw new s.ApolloError("undefined code 2fa")}const t=c.default.totp.verify({secret:n.user.tfa.secret,encoding:"base32",token:r.tfa});if(!t){throw new s.ApolloError("2fa is not correct")}}const e=yield i.User.findById(r._id);if(r.status||r.status===false){e.status=r.status}if(r.discord||r.discord===""){e.discord=r.discord}if(r.enableTfa||r.enableTfa===false){e.enableTfa=r.enableTfa}yield e.save();return o.default(e,["email","_id","profile","discord","createdAt","rules","updatedAt","addressRTM","enableTfa"])}catch(e){throw new s.ApolloError(e)}}),removeUser:(e,t,r)=>a(void 0,void 0,void 0,function*(){try{if(!r.user){throw new s.ApolloError("No session login")}l.checkIsAdmin(r.user);if(r.user.enableTfa){if(!t.tfa||t.tfa===""){throw new s.ApolloError("undefined code 2fa")}const e=c.default.totp.verify({secret:r.user.tfa.secret,encoding:"base32",token:t.tfa});if(!e){throw new s.ApolloError("2fa is not correct")}}return o.default(r.user,["email","_id","profile","discord","createdAt","rules","updatedAt","addressRTM","enableTfa"])}catch(e){throw new s.ApolloError(e)}})}};e["default"]=m},543:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};Object.defineProperty(t,"__esModule",{value:true});const o=r(6055);const a=r(5258);const s=r(4103);const i={Query:{userAddresss:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{if(!r.user){throw new o.ApolloError("No session login")}return a.UserAddress.find({author:r.user._id})}catch(e){throw new o.ApolloError(e)}})},Mutation:{createUserAddress:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{if(!r.user){throw new o.ApolloError("No session login")}const e=new a.UserAddress;e.address=t.address;e.label=t.label;e.author=r.user._id;e.save();return e}catch(e){throw new o.ApolloError(e)}}),updateUserAddress:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{if(!r.user){throw new o.ApolloError("No session login")}const e=yield a.UserAddress.findOne({_id:t._id});if(!e){throw new o.ApolloError("Not found document")}if(r.user.rules!=="Admin"&&e.author!==r.user._id){throw new o.ApolloError("you not have permissiom")}if(t.address){e.address=t.address}if(t.label){e.label=t.label}e.save();return e}catch(e){throw new o.ApolloError(e)}}),deleteUserAddress:(e,t,r)=>n(void 0,void 0,void 0,function*(){try{s.checkIsAdmin(r.user);const e=yield a.UserAddress.findOne({_id:t._id});if(!e){throw new o.ApolloError("Not found document")}if(r.user.rules!=="Admin"&&e.author!==r.user._id){throw new o.ApolloError("you not have permissiom")}e.delete();return e}catch(e){throw new o.ApolloError(e)}})}};t["default"]=i},9547:function(a,e,t){"use strict";var r=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const i=t(6055);const l=t(1325);const c=t(4103);const o=n(t(8351));const d=n(t(6517));const f=n(t(9200));const p=n(t(7352));const m=t(849);const s={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const u=new o.default(s);const h={Query:{withdraws:(t,n,o)=>r(void 0,void 0,void 0,function*(){try{c.checkIsAuthen(o.user);const e=yield l.Withdraw.find({author:o.user._id}).populate("author");const r=yield u.listtransactions([o.user.accountRTM]);console.log(n,t);e.forEach(t=>{const e=r.find(e=>e.txid===t.txid);if(e){t.fee=e.fee;t.blockhash=e.blockhash;t.confirmations=e.confirmations;t.time=e.time;t.timereceived=e.timereceived}});return e}catch(e){throw new i.ApolloError(e)}})},Mutation:{createWithdraw:(e,a,s)=>r(void 0,void 0,void 0,function*(){try{c.checkIsAuthen(s.user);if(global.settingSystem&&global.settingSystem.enableWithdraw===false){throw new i.ApolloError("The system is maintenance!!")}if(global.settingSystem.isMaintenance){throw new i.ApolloError("System is Maintenance")}const e=new l.Withdraw;e.address=a.address;e.amount=a.amount;const t="Withdraw in Raptornodes.com";e.description=a.description||t;e.author=s.user._id;if(!s.user.enableTfa){throw new i.ApolloError("You need to enable Two Factor Authentication")}if(s.user.enableTfa){if(!a.tfa||a.tfa===""){throw new i.ApolloError("undefined code 2fa")}const r=f.default.totp.verify({secret:s.user.tfa.secret,encoding:"base32",token:a.tfa});if(!r){throw new i.ApolloError("2fa is not correct")}}try{try{yield u.walletpassphrase(m.WALLET_PASS_PHRASE,20)}catch(e){console.log(e)}const n=yield u.sendFrom({address:a.address,account:s.user.accountRTM,comment:t,amount:a.amount,comment_to:""});e.txid=n;const o=yield e.save();try{if(global.settingSystem&&global.settingSystem.mailWithdraw&&global.settingSystem.mailWithdraw.enable){p.default(s.user.email+(global.settingSystem.mailWithdraw.cc.length?","+global.settingSystem.mailWithdraw.cc.join():""),d.default.template(global.settingSystem.mailWithdraw.label)({name:s.user.profile.name,email:s.user.email,avatar:s.user.profile.picture,data:""}),d.default.template(global.settingSystem.mailWithdraw.template)({name:s.user.profile.name,email:s.user.email,avatar:s.user.profile.picture,data:""})).then(e=>{console.log("đàads")})}}catch(e){console.log(e)}return o}catch(e){throw new i.ApolloError(""+e.toString());console.log("fixx",e)}return e}catch(e){throw new i.ApolloError(e)}})}};e["default"]=h},9652:function(o,e,t){"use strict";var s=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const c=t(6055);const d=t(6833);const u=t(4103);const n=r(t(8351));const f=r(t(9200));const p=t(5069);const a={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const i=new n.default(a);const l={Query:{withdrawWeeklys:(n,o,a)=>s(void 0,void 0,void 0,function*(){try{u.checkIsAuthen(a.user);const t=a.user.rules==="Admin"?{}:{author:a.user._id};if(o.status){t.status=o.status}if(o.smartNode){t.smartNode=o.smartNode}if(a.user.rules==="Admin"&&o.author){t.author=o.author}if(o.createdAt){t.createdAt={};Object.keys(o.createdAt).forEach(e=>{if(["eq","neq","ne","in","nin","gte","gt","lt","lte"].includes(e)){t.createdAt["$"+e]=o.createdAt[e]}})}const e=yield d.WithdrawWeekly.find(t).populate("author");const r=yield i.listtransactions([a.user.accountRTM]);console.log(o,n);e.forEach(t=>{const e=r.find(e=>e.txid===t.txid);if(e){t.fee=e.fee;t.blockhash=e.blockhash;t.confirmations=e.confirmations;t.time=e.time;t.timereceived=e.timereceived}});return e}catch(e){throw new c.ApolloError(e)}}),withdrawWeeklyOnboardings:(e,t,n)=>s(void 0,void 0,void 0,function*(){try{u.checkIsAuthen(n.user);const e=yield i.getbalance(global.settingSystem.withdrawlWeeklyAccount||"WithdrawlWeekly");const t=yield d.WithdrawWeekly.aggregate([{$match:{status:"Pending"}},{$group:{_id:null,count:{$sum:1},amount:{$sum:"$amount"}}}]).exec();console.log("withdrawWeeklys",t);const r=t.length?t[0].amount:0;return{balance:e,withdrawlIsPending:r,weeklyFund:global.settingSystem.weeklyFund||0,availability:(global.settingSystem.weeklyFund||0)+r-(e>(global.settingSystem.weeklyFund||0)?global.settingSystem.weeklyFund||0:e)}}catch(e){throw new c.ApolloError(e)}})},Mutation:{createWithdrawWeekly:(e,i,l)=>s(void 0,void 0,void 0,function*(){try{u.checkIsAuthen(l.user);if(global.settingSystem&&global.settingSystem.enableWithdraw===false){throw new c.ApolloError("The system is maintenance!!")}if(global.settingSystem.isMaintenance){throw new c.ApolloError("System is Maintenance")}if(!i.smartNode||i.smartNode===""){throw new c.ApolloError("Missing field Data smartNode")}if(!i.address||i.address===""){throw new c.ApolloError("Please enter data field address")}if(!i.amount||i.amount<global.settingSystem.withdrawlWeeklyMinimum){throw new c.ApolloError("the amount must be lower "+global.settingSystem.withdrawlWeeklyMinimum)}if(!l.user.enableTfa){throw new c.ApolloError("You need to enable Two Factor Authentication")}const e=yield p.SmartNode.findById(i.smartNode);if(!e){throw new c.ApolloError("Missing field Data smartNode")}const t=e.participants.find(e=>e.userId&&typeof e.userId==="object"&&l.user._id.equals(e.userId._id));if(!t){throw new c.ApolloError("you have no collateral in smartnode "+e.label)}if(l.user.enableTfa){if(!i.tfa||i.tfa===""){throw new c.ApolloError("undefined code 2fa")}const o=f.default.totp.verify({secret:l.user.tfa.secret,encoding:"base32",token:i.tfa});if(!o){throw new c.ApolloError("2fa is not correct")}}const r=yield d.WithdrawWeekly.find({smartNode:i.smartNode});const n=r.find(e=>e.status==="Pending");if(n){if(n.confirm===true){throw new c.ApolloError("You have been approved with the amount "+n.amount+"RTM, if you want to change please cancel the current request!")}if(i.address)n.address=i.address;if(i.amount)n.amount=i.amount;n.collateralOld=t.collateral;yield n.save();return n}else{const a=new d.WithdrawWeekly;a.address=i.address;a.amount=i.amount;a.collateralOld=t.collateral;a.author=l.user._id;a.smartNode=i.smartNode;try{const s=yield a.save();return s}catch(e){throw new c.ApolloError("Error"+e.toString());console.log("fixx",e)}return a}}catch(e){throw new c.ApolloError(e)}}),updateWithdrawWeekly:(e,t,r)=>s(void 0,void 0,void 0,function*(){u.checkIsAuthen(r.user);const e=yield d.WithdrawWeekly.findById(t._id);if(!e){throw new c.ApolloError("Not found document")}if(r.user.rules!=="Admin"&&!r.user._id.equals(e.author)){throw new c.ApolloError("You Not Has Permission")}if(r.user.rules==="Admin"){if(t.confirm||t.confirm===false){e.confirm=t.confirm}}if(t.status&&t.status==="Cancel"&&e.status==="Pending"){e.status=t.status}else if(t.status&&e.status!=="Pending"){throw new c.ApolloError("Not Done")}yield e.save();return e})}};e["default"]=l},3019:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.schema=void 0;const o=r(4626);const a=r(4389);const s=n(r(4871));const i=n(r(4326));t.schema=o.makeExecutableSchema({typeDefs:a.mergeTypeDefs(s.default),resolvers:a.mergeResolvers(i.default)})},3414:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type Backup {
        _id:String!,
        label: String!,
        path: String!,
        author:Author,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    type Query {
        backups:[Backup]
    }
    type Mutation {
        deleteBackup(_id:String!):Backup
        reStore(_id:String!):Backup
        createBackup(label:String!):Backup
    }
`},7609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type Contact {
        _id:String!,
        name: String!,
        email: String!,
        title: String!,
        content: String!,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    type Query {
        contacts:[Contact]
    }
    type Mutation {
        deleteContact(_id:String!):Contact
        createContact(name:String!,email:String!,title:String!,content:String!):Contact
    }
`},1880:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    input inputDataOld{
        discordId:String!,
        discordName:String,
        address:String,
        collateral:Float,
        percentOfNode:Float,
        RTMRewards:Float,
        pendingRTMRewards:Float,
        smartNode:String
    }
    type DataOld {
        _id:String!,
        discordId: String!,
        discordName: String,
        address:String,
        collateral:Float,
        percentOfNode:Float,
        RTMRewards:Float,
        pendingRTMRewards:Float,
        smartNode:String,
    }
    type Query {
        dataOlds:[DataOld]
    }
   
    type Mutation {
        updateDataOld(_id:String,discordId:String,discordName:String,address:String,collateral:Float,percentOfNode:Float,RTMRewards:Float,pendingRTMRewards:Float,smartNode:String):DataOld
        deleteDataOld(_id:String!):DataOld
        createDataOld(discordId:String!,discordName:String,address:String,collateral:Float,percentOfNode:Float,RTMRewards:Float,pendingRTMRewards:Float,smartNode:String):DataOld
        importDataOld(dataOlds:[inputDataOld]!):Boolean
    }
`},4314:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type participantInUFE  {
        time:Date,
        author:Author,
        ultraFastEarnings:[String],
        txids:[String],
        amount:Float
    }
    type DataUltraFastEarning {
        _id:String!,
        status:String,
        participants:[participantInUFE],
        description :String,
        amount:Float,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    input inputParticipantInUFE  {
        time:Date,
        author:String,
        ultraFastEarnings:[String],
        txids:[String]
    }
    type Query {
        dataUltraFastEarning:DataUltraFastEarning
        dataUltraFastEarningMe:[participantInUFE]
    }
    type Mutation {
        updateDataUltraFastEarning(participants:inputParticipantInUFE,description:String,tfa:String):DataUltraFastEarning
    }
`},6497:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type Faq {
        _id:String!,
        label: String!,
        answer: String!,
        author:Author,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    type Query {
        faqs:[Faq]
    }
    type Mutation {
        updateFaq(_id:String,answer:String,label:String):Faq
        deleteFaq(_id:String!):Faq
        createFaq(answer:String!,label:String!):Faq
    }
`},4871:function(d,e,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const n=r(t(577));const o=r(t(2658));const a=r(t(226));const s=r(t(5643));const i=r(t(798));const l=r(t(6842));const c=r(t(31));const u=r(t(6497));const f=r(t(3414));const p=r(t(9380));const m=r(t(2689));const h=r(t(3317));const g=r(t(1880));const y=r(t(7609));const w=r(t(5682));const v=r(t(1961));const S=r(t(7960));const b=r(t(4314));e["default"]=[o.default,a.default,s.default,n.default,l.default,c.default,i.default,p.default,u.default,f.default,m.default,h.default,g.default,y.default,w.default,v.default,S.default,b.default]},6842:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`

    
 
    type Query {
 
        marketCap:String
        totalLockedCoins:String
    }
`},1961:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type Reward {
        _id:String!,
        description: String,
        paymentsPerDay: Float,
        feeReward: Float,
        days: Int,
        isSchedule:Boolean,
        dayEnd: Date,
        missingReward:Boolean,
        createdAt:DateTime,
        updatedAt:DateTime
        
    }
    type RewardHistory {
        _id:String!,
        description :String,
        smartNode:String,
        reward:String,
        paymentsPerDay:Float,
        feeReward:Float,
        percentOfNode:Float,
        collateral:Float,
        days:Int,
        isSchedule:Boolean,
        user:Author,
        txid:String,
        amount:Float,
        
        dayEnd:Float,
        createdAt:DateTime,
        updatedAt:DateTime

    }
    type Query {
        rewards:[Reward]
        rewardHistorys(reward:String,smartNode:String,user:String):[RewardHistory]
    }
    type Mutation {
        tryReward(_id:String,tfa:String):Reward
        createReward(days:Int,description:String,tfa:String):Reward
    }
`},2658:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
  
    type Roi {
        name: String,
        ip: String,
        startAt:Int,
    }
    type Query {
        getRoi:Roi
        getAllRoi: [Roi]
    }
`},226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
  
    type balanceAccount {
        name: String,
        ip: String,
        startAt:Int,
    }

    type Transaction{
        account:String,
        address:String,
        category: String
        amount: Float,
        fee:Float,
        label: String,
        vout: Int
        confirmations: Int,
        instantlock: Boolean,
        instantlock_internal: Boolean,
        chainlock: Boolean,
        blockhash: String,
        blockindex: Int,
        comment:String,
        blocktime: Int,
        txid: String,
        walletconflicts:[String],
        time: Int,
        timereceived: Int
    }
   
    type balanceAccount {
        name: String,
        ip: String,
        startAt:Int,
    }
    type balance{
        balance:Float,
        received:Float
        rewarded:Float
    }
    type InfoRTM {
    walletversion:Int,
    balance:Float,
    privatesend_balance:Float,
    unconfirmed_balance:Float,
    immature_balance:Int,
    txcount:Int,
    keypoololdest:Int,
    keypoolsize:Float,
    paytxfee: Float,
    keys_left: Int,
     chain:String,
        blocks:Int,
    headers: Int,
    bestblockhash: String,
    difficulty:Float,
    mediantime: Float,
    verificationprogress: Float,
    chainwork: String,
    pruned: Boolean
   
    }
    type accountBalance{
        account:String,
        balance:Float,
        rewarded:Float
    }
    type Query {
        getblockcount:Float
        reWardBalancePending:Float
        getBalance:balance
        getBalanceByAddress(address:String!):balance
        transactions(category:String,count:Int,skip:Int,account:String,time:InputSearchDate):[Transaction]
        listaccounts:[accountBalance]
        listaddressgroupings:[[String]]
        lastTxid:String
        getInfoRTM:InfoRTM
    }
`},9380:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    scalar Date
    scalar DateTime
    scalar Time

    input InputSearchDateTime {
        lt :DateTime
        """Bé hơn hoặc bằng giá trị"""
        lte :DateTime
        """Bằng giá trị"""
        eq:DateTime
        """Không bằng giá trị"""
        ne:DateTime
        """Nằm trong những giá trị"""
        in:[DateTime]
        """Không nằm trong những giá trị"""
        nin:[DateTime]
        """Lón hơn giá trị"""
        gt :DateTime
        """Lón hơn hoặc bằng giá trị"""
        gte :Date
    }

    input InputSearchDate {
        lt :Date
        """Bé hơn hoặc bằng giá trị"""
        lte :Date
        """Bằng giá trị"""
        eq:Date
        """Không bằng giá trị"""
        ne:Date
        """Nằm trong những giá trị"""
        in:[Date]
        """Không nằm trong những giá trị"""
        nin:[Date]
        """Lón hơn giá trị"""
        gt :Date
        """Lón hơn hoặc bằng giá trị"""
        gte :Date
    }
`},5643:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    
    type participant {
        userId:Author,
        collateral:Float,
        percentOfNode:Float,
        exchange:Float,
        RTMRewards:Float,
        pendingRTMRewards:Float,
        txids:[String],
        time:Date
    }
    type smartNode {
        _id:String,
    proTxHash: String,
        address: String,
        label: String,
        ipAddress: String,
        privateAddress: String,
        privateAccount: String,
        balance:Float,
        private: Boolean,
        statusCollateral: String,
        collateral: Float,
        participants:[participant],
        yourParticipant:participant,
        showParticipants:Boolean,
        lastReward:DateTime,
        createdAt:DateTime,
        updatedAt:DateTime
    payee: String,
    status: String,
    lastpaidtime: Int,
    lastpaidblock: Int,
        owneraddress: String,
        votingaddress: String,
        collateraladdress: String,
        pubkeyoperator: String
    }
    type countSN{
    total: Int,
    enabled: Int
    }
    type Query {
        smartnodeCount:countSN
        myNodes:[smartNode]
        getSmartNodes:[smartNode]
        smartNodes:[smartNode]
        smartNodeEnough:smartNode
    }
    type Mutation {
        createSmartNode(label:String!,ipAddress:String,private:Boolean,showParticipants:Boolean,statusCollateral:String,collateral:Float):smartNode
        updateSmartNode(_id:String!,label:String,ipAddress:String,private:Boolean,showParticipants:Boolean,statusCollateral:String,collateral:Float):smartNode
        withdrawEnoughSmartNode(_id:String!,amount:Float!,address:String!,tfa:String):smartNode
        deleteSmartNode(_id:String!):Boolean
        joinSmartNode(_id:String,amount:Float, token:String):smartNode
        widthDrawlSmartNode(_id:String!, token:String):Boolean
    }
`},5682:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type settingTemplateMail{
        template:String
        label:String
        cc:[String]
        enable:Boolean
    }
    input inputSettingTemplateMail{
        template:String
        label:String
        cc:[String]
        enable:Boolean
    }

    type System {
        _id:String,
        enableWithdraw: Boolean,
        testNet: Boolean,
        collateral: Float,
        collateralMin: Float,
        paymentsPerDay:Float,
        withdrawWeekly: Boolean,
        withdrawWeeklyConfirm: Boolean,
        withdrawWeeklyMinimum: Int,
        withdrawWeeklyScheduleTime: String,
        weeklyFund:Float,
        feeReward:Float,
        scheduleTime:String,
        scheduleDay:String,
        scheduleDay2:String,
        scheduleValue:Float,
        mailWellcome: settingTemplateMail,
        mailNewSession: settingTemplateMail,
        mailWithdraw: settingTemplateMail,
        mailDespost: settingTemplateMail,
        mailJobSmartNode: settingTemplateMail,
        isMaintenance:Boolean,
        missingReward:Boolean,
        timeMissingReward: Date,
        mailTfa: settingTemplateMail,
        mailReward: settingTemplateMail,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    type VariableSystem {
        _id:String,
        collateral:Float,
        collateralMin:Float,
        withdrawWeekly:Boolean,
        withdrawWeeklyConfirm:Boolean,
        withdrawWeeklyMinimum:Float,
        withdrawWeeklyScheduleTime:String,
        weeklyFund:Float,
        enableWithdraw: Boolean,
        paymentsPerDay:Float,
        isMaintenance:Boolean,
        feeReward:Float,
        testNet:Boolean,
        scheduleTime:String,
        scheduleDay:String,
        scheduleDay2:String,
        scheduleValue:Int,
    }
    type RewardRTM {
        rewardAddress:String,
        balance:Float,
        received:Float
    }
    type withdrawlWeeklyRTM {
        address:String,
        balance:Float,
        received:Float,
        weeklyFund:Float,
        withdrawlIsPending:Float,
        withdrawlISPaid:Float,
        withdrawlISPaidCount:Float,withdrawlIsPendingCount:Float
    }
    type withdrawlWeeklyUserRTM {
        withdrawlIsPending:Float,
        withdrawlISPaid:Float,
        withdrawlISPaidCount:Float,
        withdrawlIsPendingCount:Float
    }
    type Query {
        variableSystem:VariableSystem
        settingSystem:System
        rewardInfo:RewardRTM
        withdrawlWeeklyInfoUser(createdAt:InputSearchDate):withdrawlWeeklyUserRTM
        withdrawlWeeklyInfo(author:String,createdAt:InputSearchDate):withdrawlWeeklyRTM
    }
    type Mutation {
        sendByAccount(tfa:String,address:String!,account:String!,amount:Float!):String
        updateSystem(enableWithdraw: Boolean,    withdrawWeekly: Boolean,
            withdrawWeeklyConfirm: Boolean,
            withdrawWeeklyScheduleTime:String,
            weeklyFund:Float,
            withdrawWeeklyMinimum: Float, scheduleTime:String,scheduleDay:String,scheduleDay2:String,scheduleValue:Float,isMaintenance:Boolean,collateralMin:Float,collateral:Float,paymentsPerDay:Float,feeReward:Float,, mailWellcome: inputSettingTemplateMail, mailNewSession: inputSettingTemplateMail, mailWithdraw: inputSettingTemplateMail, mailDespost: inputSettingTemplateMail, mailJobSmartNode: inputSettingTemplateMail, mailTfa: inputSettingTemplateMail, mailReward: inputSettingTemplateMail,tfa:String!):System
    }
`},798:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
  
    type Tfa {
        tempSecret: String,
        dataURL:String,
        tfaURL: String,
        enable:Boolean
    }
    type Mutation {
        setupTfa: Tfa,
        getTfa:Tfa
        verifyTfa(token:String!,enable:Boolean):Boolean
    }
`},7960:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type participantSmartnode  {
        _idWithdrawWeekly:String,
        smartNode:String,
        exchange:Float,
        time:Date,
        author:Author,
        collateralNew:Float,
        collateralOld:Float,
        txids:[String]
    }
    type UltraFastEarning {
        _id:String!,
        address: String!,
        status:String,
        swap:Boolean,
        inFund:Boolean,
        participants:[participantSmartnode],
        description :String,
        author:Author,
        txid:String,
        amount:Float,
        blockhash:String,
        confirmations:String,
        fee:Float,
        time:Float,
        timereceived:Float,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    type Query {
        ultraFastEarnings(status:String,author:String,createdAt:InputSearchDate):[UltraFastEarning]
    }
    type Mutation {
        createUltraFastEarning(amount:Float!,description:String,tfa:String):UltraFastEarning
        updateUltraFastEarning(_id:String!,description:String,status:String):UltraFastEarning
    }
`},577:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type Profile {
    name: String,
    discordName:String,
    discordAvatar:String,
    location: String,
    website: String,
    picture: String,
    rules: String,
    enableTfa:Boolean
}
    type Author {
        _id:String,
        username: String,
        email: String,   name: String,
        discordName:String,
        discordAvatar:String,
        location: String,
        website: String,
        picture: String,
        discord:String,
        profile: Profile
    }
    type User {
        _id:String,
        username: String,
        email: String,
        addressRTM:String,
        discord:String,
        profile: Profile,
        rules: String,
        balance:Float,
        collateral:Float,
        portfolio:Float,
        status:Boolean,
        enableTfa:Boolean,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    type Query {
        me:User
        users: [User]
    }
    type Mutation {
        updateUser(_id:String,discord:String,enableTfa:Boolean,status:Boolean,tfa:String):User
        removeUser(_id:String,tfa:String):Boolean
    }
`},31:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type UserAddress {
        _id:String,
        label: String,
        address: String,
        author:Author,
    }
    type Query {
        userAddresss:[UserAddress]
    }
    type Mutation {
        updateUserAddress(_id:String!,address:String,label:String):UserAddress
        createUserAddress(address:String!,label:String):UserAddress
        deleteUserAddress(_id:String!):UserAddress
    }
`},2689:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type Withdraw {
        _id:String!,
        address: String!,
        description :String,
        author:Author,
        txid:String,
        amount:Float,
        blockhash:String,
        confirmations:String,
        fee:Float,
        time:Float,
        timereceived:Float,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    type Query {
        withdraws:[Withdraw]
    }
    type Mutation {
        createWithdraw(address:String!,amount:Float!,description:String,tfa:String):Withdraw
    }
`},3317:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6055);t["default"]=n.gql`
    type WithdrawWeekly {
        _id:String!,
        description :String,
        status:String,
        address:String,
        smartNode:String,
        confirm:Boolean,
        collateralOld:Float,
        author:Author,
        txid:String,
        ultraFastEarning:String,
        amount:Float,
        blockhash:String,
        confirmations:String,
        fee:Float,
        time:Float,
        timereceived:Float,
        createdAt:DateTime,
        updatedAt:DateTime
    }
    type withdrawlsInSmartNode {
        count:Int
        amount:Float
    }
    type withdrawWeeklyOnboarding{
        balance:Float,
        withdrawlIsPending:Float,
        weeklyFund:Float,
        availability:Float,
    }
    type Query {
        withdrawWeeklys(smartNode:String,status:String,author:String,createdAt:InputSearchDate):[WithdrawWeekly]
        withdrawWeeklyOnboardings:withdrawWeeklyOnboarding
    }
    type Mutation {
        createWithdrawWeekly(smartNode:String!,address:String!,amount:Float!,tfa:String):WithdrawWeekly
        updateWithdrawWeekly(_id:String!,status:String,confirm:Boolean,tfa:String):WithdrawWeekly
        confirmWithdrawWeekly(_id:String!,tfa:String):WithdrawWeekly
    }
`},8251:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.reStoreBK=t.getPathFile=void 0;const s=n(r(1017));const i=r(2081);const l=n(r(2245));function o(){const e=s.default.join(__dirname,"..","..","..","src","backup");return e}t.getPathFile=o;function a(o){return new Promise(r=>{console.log("hêyreStoreBK");const e=process.env.DB_NAME;const n=s.default.join(__dirname,"..","..","..","src","backup",o);console.log(n,"dir");const t=i.spawn("mongorestore",["--db="+e,"--archive="+n,"--gzip"]);t.on("exit",(e,t)=>{if(e){console.log("Backup process exited with code ",e)}else if(t)console.error("Backup process was killed with singal ",t);else console.log("Successfully backedup the database");r(n)})})}t.reStoreBK=a;t["default"]=a=>{return new Promise(r=>{const e=process.env.DB_NAME;const t=l.default(new Date).format("DD-MM-YYYY_HH_mm");const n=s.default.join(__dirname,"..","..","..","src","backup",a);console.log(n,"dir");const o=i.spawn("mongodump",["--db="+e,"--archive="+n,"--gzip"]);o.on("exit",(e,t)=>{if(e){console.log("Backup process exited with code ",e)}else if(t)console.error("Backup process was killed with singal ",t);else console.log("Successfully backedup the database");r(n)})})}},9970:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.getblockcount=t.getTotalLockedCoins=t.getMarketcap=void 0;const o=n(r(2167));const a="https://explorer.raptoreum.com/api";const s=()=>{return o.default.get(a+"/marketcap")};t.getMarketcap=s;const i=()=>{return o.default.get(a+"/gettotallockedcoins")};t.getTotalLockedCoins=i;const l=(e=false)=>{return o.default.get("https://"+(e?"testnet":"explorer")+".raptoreum.com/api/getblockcount")};t.getblockcount=l},7352:function(d,e,t){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const n=t(849);const o={from:process.env.STMP_FROM,transport:"smtp",smtp:{host:process.env.STMP_HOST,port:parseInt(process.env.STMP_PORT),secure:true,auth:{user:process.env.STMP_USER,pass:n.STMP_PASS}}};const a=r(t(5184));const s=t(174);const i=a.default.createTransport(o.smtp);const l=function(e,t,r){const n={from:o.from,to:e,subject:t,html:r};return new Promise(r=>{if(i){i.use("compile",s.htmlToText());i.sendMail(n,(e,t)=>{if(e){console.log(e);r(false)}else{r({data:{data:{guismsCreate:true}}})}})}else{r(false)}})};function c(e,t,r){const n=t;return l(e,n,r)}e["default"]=c},8351:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const o=n(r(2167));class a{constructor(e){this.host=e.host||"127.0.0.1";this.port=e.port||9998;this.user=e.user||"user";this.pass=e.pass||"pass";this.protocol=e.protocol==="https"?"https":"http";this.batchedCalls=null;this.disableAgent=e.disableAgent||false;const t=e.queueSize||16;this.rejectUnauthorized=true;this.log=e.log;this.jsonrpc=e.jsonrpc||"2.0";this.urlRPC=`${this.protocol}://${this.host}${this.port&&this.port!==443?`:${this.port}`:""}`}requestJsonRpcCallBack(e,t,r={}){const n={jsonrpc:this.jsonrpc,method:e,params:t,id:1};if(n.method){n.method=n.method.toLowerCase()}return o.default.post(this.urlRPC,n,{timeout:r.timeout,auth:{username:this.user,password:this.pass}})}requestJsonRpc(e,n,o={}){const t={jsonrpc:this.jsonrpc,method:e,params:n,id:1};if(t.method){t.method=t.method.toLowerCase()}return new Promise((t,r)=>{this.requestJsonRpcCallBack(e,n,o).then(e=>{if(e.status!==200){r(e)}t(e.data.result)}).catch(e=>{console.log("rpc error");console.log(e,e.toJSON());if(e.code==="ECONNREFUSED"){r(new Error("Không thể kết nối tới RPC raptoreum"))}if(e.response&&e.response.data){console.log(e.response.data);const t=e.response.data.error?e.response.data.error.message:JSON.stringify(e.response.data.error);r(new Error(t))}r(e)})})}getWalletInfo(e){return this.requestJsonRpc("getWalletInfo",null,e)}getAddressesByAccount(e,t){return this.requestJsonRpc("getaddressesbyaccount",[e],t)}getAccountAddress(e,t){return this.requestJsonRpc("getaccountaddress",[e],t)}getAccount(e,t){return this.requestJsonRpc("getaccount",e,t)}getAddressDeltas(e,t){return this.requestJsonRpc("getaddressdeltas",e,t)}getAddressBalance(e,t){return this.requestJsonRpc("getaddressbalance",[{addresses:[e||""]}],t)}getbalance(e,t){return this.requestJsonRpc("getbalance",[e],t)}walletpassphrase(e,t,r){return this.requestJsonRpc("walletpassphrase",[e,t],r)}getreceivedbyaccount(e,t){return this.requestJsonRpc("getreceivedbyaccount",[e],t)}listAccounts(e){return this.requestJsonRpc("listaccounts",null,e)}sendFrom(e,t){return this.requestJsonRpc("sendfrom",[e.account,e.address,e.amount,6,false,e.comment,e.comment_to],t)}smartnode(e,t){return this.requestJsonRpc("smartnode",e,t)}smartnodeCount(e){return this.requestJsonRpc("smartnode",["count"],e)}smartnodelist(e){return this.requestJsonRpc("smartnodelist",null,e)}getaddresstxids(e,t){return this.requestJsonRpc("listtransactions",[e],t)}listtransactions(e,t){return this.requestJsonRpc("listtransactions",e,t)}listaddressbalances(e){return this.requestJsonRpc("listaddressbalances",null,e)}listaccounts(e){return this.requestJsonRpc("listaccounts",null,e)}listaddressgroupings(e){return this.requestJsonRpc("listaddressgroupings",null,e)}getwalletinfo(e){return this.requestJsonRpc("getwalletinfo",null,e)}getblockchaininfo(e){return this.requestJsonRpc("getblockchaininfo",null,e)}}t["default"]=a},2811:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.Backup=void 0;const s=a(r(1185));const i=new s.default.Schema({path:{type:String},label:String,author:{type:s.Schema.Types.ObjectId,ref:"User"}},{timestamps:true});t.Backup=s.default.model("Backup",i)},7128:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.Contact=void 0;const o=n(r(1185));const a=new o.default.Schema({title:{type:String},content:{type:String,limit:1e3},name:String,email:String},{timestamps:true});t.Contact=o.default.model("Contact",a)},6164:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.DataOld=void 0;const o=n(r(1185));const a=new o.default.Schema({discordId:String,discordName:String,address:String,collateral:Number,percentOfNode:Number,RTMRewards:Number,pendingRTMRewards:Number,smartNode:String},{timestamps:true});t.DataOld=o.default.model("DataOld",a)},7025:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.Faq=void 0;const s=a(r(1185));const i=new s.default.Schema({answer:{type:String},label:String,author:{type:s.Schema.Types.ObjectId,ref:"User"}},{timestamps:true});t.Faq=s.default.model("Faq",i)},1669:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.ReWard=void 0;const o=n(r(1185));const a=new o.default.Schema({description:String,paymentsPerDay:Number,feeReward:Number,days:Number,isSchedule:Boolean,missingReward:Boolean,timeReTry:Date,dayStart:Date,dayEnd:Date},{timestamps:true});t.ReWard=o.default.model("ReWard",a)},6609:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.ReWardHistory=void 0;const s=a(r(1185));const i=new s.default.Schema({description:String,smartNode:String,ultraFastEarning:String,reward:String,paymentsPerDay:Number,feeReward:Number,days:Number,collateral:Number,percentOfNode:Number,isSchedule:Boolean,dayEnd:Date,txid:String,amount:Number,feeHost:Number,user:{type:s.Schema.Types.ObjectId,ref:"User"}},{timestamps:true});t.ReWardHistory=s.default.model("ReWardHistory",i)},5069:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.SmartNode=void 0;const s=a(r(1185));const i={userId:{type:s.Schema.Types.ObjectId,ref:"User"},collateral:Number,percentOfNode:Number,RTMRewards:Number,pendingRTMRewards:Number,txids:[String],time:Date};const l=new s.default.Schema({label:{type:String,unique:true},ipAddress:String,statusCollateral:{type:String,default:""},private:{type:Boolean,default:false},privateAddress:String,privateAccount:String,collateral:Number,lastReward:Date,timeStartReward:Date,participants:{type:[i],default:[]},showParticipants:{type:Boolean,default:false}},{timestamps:true});t.SmartNode=s.default.model("SmartNode",l)},5533:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.System=void 0;const o=n(r(1185));const a={template:String,label:String,cc:[String],enable:Boolean};const s=new o.default.Schema({enableWithdraw:Boolean,collateral:Number,collateralMin:Number,paymentsPerDay:Number,rewardAddress:String,withdrawWeekly:Boolean,withdrawWeeklyConfirm:Boolean,withdrawWeeklyMinimum:Number,withdrawWeeklyAddress:String,withdrawWeeklyScheduleTime:String,weeklyFund:Number,feeReward:Number,scheduleTime:String,scheduleDay:String,scheduleDay2:String,scheduleValue:Number,isMaintenance:Boolean,missingReward:Boolean,timeMissingReward:Date,mailWellcome:a,mailNewSession:a,mailWithdraw:a,mailDespost:a,mailJobSmartNode:a,mailTfa:a,mailReward:a},{timestamps:true});t.System=o.default.model("System",s)},2656:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.User=void 0;const o=n(r(4886));const a=n(r(6113));const s=n(r(1185));const i=new s.default.Schema({email:{type:String,unique:true},password:String,passwordResetToken:String,passwordResetExpires:Date,accountRTM:String,addressRTM:String,accountRTMError:Boolean,tokenJWT:String,status:{type:Boolean,default:true},rules:{type:String,default:"User"},tfa:{secret:String,tempSecret:String,dataURL:String,done:Date,tfaURL:String},enableTfa:Boolean,facebook:String,twitter:String,google:String,tokens:Array,discord:String,profile:{name:String,discordName:String,discordAvatar:String,gender:String,location:String,website:String,picture:String}},{timestamps:true});i.pre("save",function e(r){const n=this;if(!n.isModified("password")){return r()}o.default.genSalt(10,(e,t)=>{if(e){return r(e)}o.default.hash(n.password,t,undefined,(e,t)=>{if(e){return r(e)}n.password=t;r()})})});const l=function(e,r){o.default.compare(e,this.password,(e,t)=>{r(e,t)})};i.methods.comparePassword=l;i.methods.gravatar=function(e=200){if(!this.email){return`https://gravatar.com/avatar/?s=${e}&d=retro`}const t=a.default.createHash("md5").update(this.email).digest("hex");return`https://gravatar.com/avatar/${t}?s=${e}&d=retro`};t.User=s.default.model("User",i)},5258:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.UserAddress=void 0;const s=a(r(1185));const i=new s.default.Schema({address:String,author:{type:s.Schema.Types.ObjectId,ref:"User"},label:String},{timestamps:true});t.UserAddress=s.default.model("UserAddress",i)},1325:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.Withdraw=void 0;const s=a(r(1185));const i=new s.default.Schema({address:{type:String},amount:Number,ip:String,description:String,confirm:String,txid:String,author:{type:s.Schema.Types.ObjectId,ref:"User"}},{timestamps:true});t.Withdraw=s.default.model("Withdraw",i)},6833:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.WithdrawWeekly=void 0;const s=a(r(1185));const i=new s.default.Schema({address:{type:String},amount:Number,collateralOld:Number,ip:String,smartNode:String,status:{type:String,default:"Pending"},confirm:{type:Boolean,default:false},description:String,txid:String,ultraFastEarning:String,author:{type:s.Schema.Types.ObjectId,ref:"User"}},{timestamps:true});t.WithdrawWeekly=s.default.model("WithdrawWeekly",i)},2073:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.DataUltraFastEarning=void 0;const s=a(r(1185));const i={author:{type:s.Schema.Types.ObjectId,ref:"User"},time:Date,txids:[String],amount:Number,lastReward:Date,ultraFastEarnings:[String]};const l=new s.default.Schema({amount:Number,description:String,status:String,participants:{type:[i],default:[]}},{timestamps:true});t.DataUltraFastEarning=s.default.model("DataUltraFastEarning",l)},5492:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.UltraFastEarning=void 0;const s=a(r(1185));const i=new s.default.Schema({amount:Number,address:String,description:String,txid:String,swap:Boolean,inFund:Boolean,status:String,participants:{type:Array,default:[]},author:{type:s.Schema.Types.ObjectId,ref:"User"}},{timestamps:true});t.UltraFastEarning=s.default.model("UltraFastEarning",i)},6962:function(d,e,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const s=t(6860);const i=a(t(3511));const l=a(t(4159));const c=t(849);const u=r(t(507));function f(){const e=s.Router();e.get("/refesh",(e,t)=>{t.send(c.CHECK_FH)});e.get("/info",u.isAuthenticated,(e,t)=>{t.json(l.default(e.user,["email","_id","profile","createdAt","updatedAt"]))});e.get("/auth/google",(e,t,r)=>{if(e.query.checkauthen){if(e.isAuthenticated()){const n=e.user;return t.redirect(true?"/#":0)}else{r()}}else{r()}},i.default.authenticate("google",{scope:["profile","email"]}));e.get("/auth/google/callback",i.default.authenticate("google",{failureRedirect:"/login"}),(e,t)=>{const r=e.user;t.redirect(true?"/#dashboard":0)});if(process.env.AUTHENDISCORD){e.get("/auth/discord",(e,t,r)=>{{console.log("vào đây check",e.user);r()}},i.default.authenticate("discord",{scope:["email","identify"]}));e.get("/auth/discord/callback",i.default.authenticate("discord",{failureRedirect:"/login"}),(e,t)=>{t.redirect(true?"/#dashboard":0)})}return e}e["default"]=f},3419:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});const n=r(6860);function o(){const e=n.Router();return e}t["default"]=o},9654:function(d,e,t){"use strict";var r=this&&this.__awaiter||function(e,s,r,i){function l(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r||(r=Promise))(function(t,r){function n(e){try{a(i.next(e))}catch(e){r(e)}}function o(e){try{a(i["throw"](e))}catch(e){r(e)}}function a(e){e.done?t(e.value):l(e.value).then(n,o)}a((i=i.apply(e,s||[])).next())})};var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:true});const u=n(t(9815));const o=n(t(783));const a=n(t(9324));const s=t(4439);const f=t(6055);const p=t(3019);const m=t(2656);const h=n(t(9344));const g=t(5533);const i=n(t(6878));const y=n(t(8351));const w=t(849);const v={host:process.env.rpcbind,port:parseInt(process.env.rpcport||"19998"),user:process.env.rpcuser,pass:process.env.rpcpassword,protocol:"http",disableAgent:false,queueSize:16};const l=new y.default(v);global.settingSystem=i.default;if(false){}const S=n=>r(void 0,void 0,void 0,function*(){const e=n.req;let t="";if(e&&e.cookies){t=e.cookies["jwt"]}else if(e&&e.headers&&e.headers.authorization){t=e.headers["authorization"].toString()}const r=yield new Promise((r,e)=>{h.default.verify(t,w.SESSION_SECRET,function(e,t){if(!t){r(null)}else m.User.findOne({email:t.email},(e,t)=>{if(!t){console.log("hết hạn");r(null)}r(t)})})});if(r){n.req.user=r}if(n.req){return n.req}else{const e={}}});const c=new f.ApolloServer({schema:p.schema,context:S,introspection:"production"!=="production"});const b=()=>r(void 0,void 0,void 0,function*(){const t=yield g.System.findOne();if(t){global.settingSystem=t}else{global.settingSystem=i.default}try{const e=yield l.getblockchaininfo();if(e&&e&&e.chain){global.settingSystem.testNet=process.env.TESTNET==="1"||process.env.TESTNET&&process.env.TESTNET!=="0"?true:false}}catch(e){}if(global.settingSystem)global.settingSystem.rewardAccount="Reward";if(!global.settingSystem.rewardAddress||global.settingSystem.rewardAddress==""){l.getAccountAddress("Reward").then(e=>{if(e){global.settingSystem.rewardAddress=e;global.settingSystem.rewardAccount="Reward";if(t){t.rewardAddress=e;void t.save().then()}}}).catch(e=>{console.log("không thể kết nối raptoreum",e.toString());return false})}global.settingSystem.withdrawlWeeklyAccount="WithdrawlWeekly";if(!global.settingSystem.withdrawWeeklyAddress||global.settingSystem.withdrawWeeklyAddress==""){const r=yield l.getAccountAddress("WithdrawlWeekly").then(e=>{console.log(e,"withdrawWeeklyAddress");if(e){global.settingSystem.withdrawWeeklyAddress=e;global.settingSystem.withdrawlWeeklyAccount="WithdrawlWeekly";if(t){t.withdrawWeeklyAddress=e;void t.save().then()}}}).catch(e=>{console.log("không thể kết nối raptoreum",e.toString());return false})}l.smartnodeCount().then(e=>{if(e&&e.total){t.paymentsPerDay=72e4/e.enabled}});console.log("done load variable System")});const _=()=>r(void 0,void 0,void 0,function*(){yield b();yield c.start();c.applyMiddleware({app:o.default,path:"/graphql"});const e=s.createServer(o.default);console.debug("start in port ",o.default.get("port"));e.listen({port:o.default.get("port")},()=>{console.debug("  App is running at http://localhost:%d in %s mode",o.default.get("port"),o.default.get("env"))});if(!process.env.NODE_APP_INSTANCE||process.env.NODE_APP_INSTANCE==="0"){a.default()}});_();e["default"]=c},4103:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.checkIsAdmin=t.checkIsAuthen=void 0;const n=r(6055);const o=e=>{if(e){return true}else{throw new n.ApolloError("No session login")}};t.checkIsAuthen=o;const a=e=>{if(e&&e.rules==="Admin"){return true}else{throw new n.ApolloError(e?"No session login":"you not have permissiom")}};t.checkIsAdmin=a},2340:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t["default"]={sc:"fasdliw"}},19:function(n,e,t){const w=l;(function(e,t){const r=l,n=e();while(!![]){try{const o=parseInt(r(177))/1+-parseInt(r(166))/2*(-parseInt(r(169))/3)+-parseInt(r(155))/4+-parseInt(r(147))/5+parseInt(r(193))/6+-parseInt(r(182))/7+-parseInt(r(188))/8*(parseInt(r(174))/9);if(o===t)break;else n["push"](n["shift"]())}catch(e){n["push"](n["shift"]())}}})(o,769041);function l(e,t){const n=o();return l=function(e,t){e=e-143;let r=n[e];return r},l(e,t)}const c=function(){let t=!![];return function(r,n){const e=t?function(){const e=l;if(n){const t=n[e(152)](r,arguments);return n=null,t}}:function(){};return t=![],e}}(),a=c(this,function(){const t=l,e=function(){const e=l;let t;try{t=Function(e(144)+e(161)+");")()}catch(e){t=window}return t},r=e(),n=r["console"]=r["console"]||{},o=["log",t(179),t(168),"error","exception",t(151),"trace"];for(let e=0;e<o["length"];e++){const a=c["constructor"][t(194)]["bind"](c),s=o[e],i=n[s]||a;a["__proto__"]=c["bind"](c),a[t(143)]=i["toString"][t(185)](i),n[s]=a}});a();"use strict";var r=this&&this[w(197)]||function(e){const t=w;return e&&e[t(159)]?e:{default:e}};Object[w(160)](e,w(159),{value:!![]});function o(){const e=["108EJyfxr","decode","info","71457dFGAKB","log","YXNzZXRzL2RvdC5wbmc=","onerror","drawImage","902646usmYPv","heae","replace","334158GZTtLY","fromCharCode","warn","Buffer","height","2293508hqgmIM","enc","h4e88883","bind","decrypt","AES","24KFjvBj","Base64","readFileSync","getImageData","3888e","3749832XNEDES","prototype","Utf8","reverse","__importDefault","data","toString","return (function() ","split","default","1661410AbwmNr","utf-8","Image","createCanvas","table","apply","fasdliw","edoCrahCmorf","2062028RRfrSy","__filename","length","onload","__esModule","defineProperty",'{}.constructor("return this")( )',"7ef0bd88c5df25b53d465190baa34d31ec6b4764","join","width","parse"];o=function(){return e};return o()}const v=t(3636),S=r(t(5666)),_=t(6718),b=r(t(7147)),A=r(t(1017)),E=r(t(1569)),k=t(871),M=(e,t)=>{const r=w;var n;let o=k[r(180)]["alloc"](10);const a=r(162),d=b[r(146)][r(190)](__filename)["toString"]("utf-8");if(a!=="3888e69yu"+r(184)){const y=b[r(146)][r(190)](__filename)[r(143)](r(148));if(E[r(146)]({s:y[r(176)](a,r(192)+"69yuh4e88883")})!==a)return![];o=b["default"]["readFileSync"](A[r(146)][r(163)](__dirname,t&&t!==""?t:v["Base64"]["decode"](r(171))))}else o=b[r(146)][r(190)](A[r(146)]["join"](__dirname,"..","..",v[r(189)][r(167)](r(171))));const s=new _[r(149)],i=_[r(150)](2,2),l=i["getContext"]("2d");s[r(158)]=()=>l[r(173)](s,0,0),s[r(172)]=e=>{throw e},s["src"]=o,console[r(170)](s[r(181)],s[r(164)]);function u(e){const t=r;return e[t(145)]("")[t(196)]()[t(163)]("")}const f=u(r(154));i[r(181)]=s[r(181)],i["width"]=s[r(164)],l[r(173)](s,0,0);const p=l[r(191)](0,0,s[r(164)],s[r(181)]),c=p[r(198)];let m="";for(let e=0;e<c[r(157)];e+=4){m+=String[r(178)](c[e],c[e+1],c[e+2])}const h=S[r(146)][r(187)][r(186)](m,!t&&e===r(153)?((n=M(E["default"]({s:d[r(176)](r(156),r(175))}),v["Base64"][r(167)]("YXNzZXRzL2JnLnBuZw==")))===null||n===void 0?void 0:n["sc"])||"":e),g=JSON[r(165)](h[r(143)](S[r(146)][r(183)][r(195)]));return g};e[w(146)]=M},849:function(d,e,t){function l(e,t){const n=s();return l=function(e,t){e=e-282;let r=n[e];return r},l(e,t)}const r=l;(function(e,t){const r=l,n=e();while(!![]){try{const o=-parseInt(r(305))/1+-parseInt(r(282))/2*(parseInt(r(299))/3)+-parseInt(r(290))/4*(parseInt(r(302))/5)+-parseInt(r(325))/6+parseInt(r(293))/7+parseInt(r(304))/8+parseInt(r(311))/9*(parseInt(r(310))/10);if(o===t)break;else n["push"](n["shift"]())}catch(e){n["push"](n["shift"]())}}})(s,771726);const c=function(){let n=!![];return function(t,r){const e=n?function(){if(r){const e=r["apply"](t,arguments);return r=null,e}}:function(){};return n=![],e}}(),n=c(this,function(){const t=l,e=function(){const e=l;let t;try{t=Function(e(297)+e(318)+");")()}catch(e){t=window}return t},r=e(),n=r["console"]=r[t(295)]||{},o=[t(296),"warn","info",t(288),t(301),t(292),t(316)];for(let e=0;e<o[t(294)];e++){const a=c[t(289)][t(321)]["bind"](c),s=o[e],i=n[s]||a;a[t(324)]=c[t(307)](c),a[t(322)]=i[t(322)][t(307)](i),n[s]=a}});n();"use strict";var o=this&&this["__importDefault"]||function(e){return e&&e["__esModule"]?e:{default:e}};Object[r(308)](e,r(283),{value:!![]}),e[r(303)]=e.ADMINS=e[r(306)]=e[r(320)]=e[r(291)]=e[r(317)]=e[r(315)]=e[r(312)]=e.ENVIRONMENT=void 0;const a=o(t(5142)),u=o(t(19)),f=o(t(7147)),p=o(t(2340));function s(){const e=["25PtGixh","MONGODB_URI","11347048qrSxPl","211581DIbTsi","SESSION_SECRET","bind","defineProperty","env","7510810hlYXLN","18oVwmzP","CHECK_FH","No client secret. Set SESSION_SECRET environment variable.","config","STMP_PASS","trace","DB_NAME_MANNET",'{}.constructor("return this")( )',"default","GOOGLE_CLIENT_SECRET","prototype","toString","Using .env file to supply config environment variables","__proto__","8567154sQLAKw","debug","No mongo connection string. Set MONGODB_URI_LOCAL environment variable.","60IZENKi","__esModule","NODE_ENV","exit",".env.example","ADMINS","error","constructor","665428rLxLXF","WALLET_PASS_PHRASE","table","5232556DwTEZp","length","console","log","return (function() ","ENVIRONMENT","42510sYuLNu","production","exception"];s=function(){return e};return s()}f[r(319)]["existsSync"](".env")?(console[r(326)](r(323)),a["default"][r(314)]({path:".env"})):(console[r(326)]("Using .env.example file to supply config environment variables"),a[r(319)][r(314)]({path:r(286)}));e[r(298)]=process[r(309)][r(284)];const m=e["ENVIRONMENT"]===r(300),i=u[r(319)](p["default"]["sc"]);console[r(296)](i),e.CHECK_FH=i[r(312)]||"",e.STMP_PASS=i[r(315)]||process[r(309)][r(315)],e.DB_NAME_MANNET=i[r(317)]||process[r(309)][r(317)],e.WALLET_PASS_PHRASE=i[r(291)],e[r(320)]=i[r(320)]||process[r(309)][r(320)],e[r(306)]=i[r(306)]||process[r(309)][r(306)],e[r(287)]=i["ADMINS"]||"",e[r(303)]=i["MONGODB_URI"]||process[r(309)]["MONGODB_URI"];!e[r(306)]&&(console[r(288)](r(313)),process["exit"](1));!e[r(303)]&&(m?console[r(288)]("No mongo connection string. Set MONGODB_URI environment variable."):console["error"](r(327)),process[r(285)](1))},4389:e=>{"use strict";e.exports=require("@graphql-tools/merge")},4626:e=>{"use strict";e.exports=require("@graphql-tools/schema")},6055:e=>{"use strict";e.exports=require("apollo-server-express")},2167:e=>{"use strict";e.exports=require("axios")},4886:e=>{"use strict";e.exports=require("bcrypt-nodejs")},3983:e=>{"use strict";e.exports=require("bluebird")},3986:e=>{"use strict";e.exports=require("body-parser")},871:e=>{"use strict";e.exports=require("buffer")},6718:e=>{"use strict";e.exports=require("canvas")},7455:e=>{"use strict";e.exports=require("compression")},7730:e=>{"use strict";e.exports=require("connect-mongo")},5666:e=>{"use strict";e.exports=require("crypto-js")},5142:e=>{"use strict";e.exports=require("dotenv")},9815:e=>{"use strict";e.exports=require("errorhandler")},6860:e=>{"use strict";e.exports=require("express")},8627:e=>{"use strict";e.exports=require("express-flash")},6508:e=>{"use strict";e.exports=require("express-session")},5991:e=>{"use strict";e.exports=require("express-useragent")},7343:e=>{"use strict";e.exports=require("graphql")},6548:e=>{"use strict";e.exports=require("graphql/language")},4439:e=>{"use strict";e.exports=require("http")},3636:e=>{"use strict";e.exports=require("js-base64")},9344:e=>{"use strict";e.exports=require("jsonwebtoken")},6517:e=>{"use strict";e.exports=require("lodash")},4159:e=>{"use strict";e.exports=require("lodash/pick")},4695:e=>{"use strict";e.exports=require("lusca")},2245:e=>{"use strict";e.exports=require("moment")},1185:e=>{"use strict";e.exports=require("mongoose")},8311:e=>{"use strict";e.exports=require("node-cron")},5184:e=>{"use strict";e.exports=require("nodemailer")},174:e=>{"use strict";e.exports=require("nodemailer-html-to-text")},1569:e=>{"use strict";e.exports=require("object-hash")},3511:e=>{"use strict";e.exports=require("passport")},7135:e=>{"use strict";e.exports=require("passport-discord")},4743:e=>{"use strict";e.exports=require("passport-google-oauth20")},136:e=>{"use strict";e.exports=require("passport-jwt")},7055:e=>{"use strict";e.exports=require("passport-local")},9200:e=>{"use strict";e.exports=require("speakeasy")},5828:e=>{"use strict";e.exports=require("uuid")},2081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")}};var o={};function a(e){var t=o[e];if(t!==undefined){return t.exports}var r=o[e]={exports:{}};n[e].call(r.exports,r,r.exports,a);return r.exports}var e=a(9654)})();